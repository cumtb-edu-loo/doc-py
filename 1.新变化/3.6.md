# Python 3.6 有什么新变化¶

编者:

    

~~~
Elvis Pranskevichus <[elvis@magic.io](mailto:elvis%40magic.io)>, Yury Selivanov <[yury@magic.io](mailto:yury%40magic.io)>

本文解释了与3.5相比，Python 3.6中的新功能。 Python 3.6于2016年12月23日发布。请参阅 [changelog](https://docs.python.org/3.6/whatsnew/changelog.md) 以获取完整的更改列表。

参见

[**PEP 494**](https://peps.python.org/pep-0494/) \- Python 3.6 发布计划

## 摘要 -- 发布重点¶

新的语法特性：

  * PEP 498, 格式化字符串字面值

  * PEP 515, 数字字面值中的下划线。

  * PEP 526 , 变量标注语法。

  * PEP 525，异步生成器。

  * PEP 530: 异步推导式。

新的库模块：

  * [`secrets`](../library/secrets.md#module-secrets "secrets: Generate secure random numbers for managing secrets."): PEP 506 -- Python 标准库增加一个密码模块。

CPython 实现的改进：

  * 根据 [Raymond Hettinger 的提议](https://mail.python.org/pipermail/python-dev/2012-December/123028.md) 已将 [dict](../library/stdtypes.md#typesmapping) 类型重新实现为使用 更紧凑的表示形式 并类似于 [PyPy dict implementation](https://morepypy.blogspot.com/2015/01/faster-more-memory-efficient-and-more.md)。 这使得字典所使用的内存相对于 Python 3.5 版减少了 20% 到 25%。

  * 类创建的定制过程通过 新协议 得到了简化。

  * 类属性的定义顺序 现在会被保留。

  * 现在 `**kwargs` 中的元素会与传给函数的关键字参数 保持对应顺序。

  * 添加了 DTrace 和 SystemTap 探测支持

  * 新的 PYTHONMALLOC 环境变量可被用来调试解释器的内存分配和访问错误。

标准库中的重大改进：

  * [`asyncio`](../library/asyncio.md#module-asyncio "asyncio: Asynchronous I/O.") 模块获得了许多新特性，显著的可用性和性能提升，以及大量的问题修正。 从 Python 3.6 开始 `asyncio` 模块不再处于待定状态，它已被视为稳定 API。

  * 实现了新的 文件系统路径协议 以支持 [路径类对象](../glossary.md#term-path-like-object)。 所有操作路径的标准库函数已被更新为使用新的协议。

  * [`datetime`](../library/datetime.md#module-datetime "datetime: Basic date and time types.") 模块已获得对 本地时间消歧义 的支持。

  * [`typing`](../library/typing.md#module-typing "typing: Support for type hints \(see :pep:`484`\).") 模块获得了大量的 改进。

  * [`tracemalloc`](../library/tracemalloc.md#module-tracemalloc "tracemalloc: Trace memory allocations.") 模块已被大幅重写，现在将被用于为 [`ResourceWarning`](../library/exceptions.md#ResourceWarning "ResourceWarning") 提供更好的输出，并为内存分配错误提供更好的诊断。 请参阅 PYTHONMALLOC 一节 来了解详情。

安全改进：

  * 添加了 [`secrets`](../library/secrets.md#module-secrets "secrets: Generate secure random numbers for managing secrets.") 模块以简化适用于密码管理的高加密强度伪随机数的生成，例如账户验证、安全凭据等场景。

  * 在 Linux 上，现在 [`os.urandom()`](../library/os.md#os.urandom "os.urandom") 会阻塞直到系统的 urandom 熵池被初始化以提升安全性。 其理由参见 [**PEP 524**](https://peps.python.org/pep-0524/)。

  * [`hashlib`](../library/hashlib.md#module-hashlib "hashlib: Secure hash and message digest algorithms.") 和 [`ssl`](../library/ssl.md#module-ssl "ssl: TLS/SSL wrapper for socket objects") 模块现在支持 OpenSSL 1.1.0。

  * [`ssl`](../library/ssl.md#module-ssl "ssl: TLS/SSL wrapper for socket objects") 模块的默认设置和特性集已得到改进。

  * [`hashlib`](../library/hashlib.md#module-hashlib "hashlib: Secure hash and message digest algorithms.") 模块获得了对 BLAKE2, SHA-3 和 SHAKE 哈希算法以及 [`scrypt()`](../library/hashlib.md#hashlib.scrypt "hashlib.scrypt") 密钥派生函数的支持。

Windows改进：

  * PEP 528 和 PEP 529, 将Windows文件系统和控制台的编码更改为UTF-8

  * 在交互式地使用 `py.exe` 启动器时，当用户未（通过命令行参数或配置文件）指定版本时不再优先选择 Python 2 而是选择 Python 3。 对声明行的处理则保持不变 —— 在这种情况下 "python" 还是指 Python 2。

  * `python.exe` 和 `pythonw.exe` 已被标记为支持长路径，这意味着不再有 260 个字符的路径长度限制。 详情参见 [移除 MAX_PATH 限制](../using/windows.md#max-path)。

  * 可以添加一个 `._pth` 文件来强制使用隔离模式和完整指定所有搜索路径来避免注册表和环境查找。 更多信息请参阅 [相关文档](../using/windows.md#windows-finding-modules)。

  * 现在 `python36.zip` 文件可以作为推断 [`PYTHONHOME`](../using/cmdline.md#envvar-PYTHONHOME) 的标记物。 请参阅 [相关文档](../using/windows.md#windows-finding-modules) 了解详情。

## 新的特性¶

### PEP 498: 格式化字符串字面值¶

[**PEP 498**](https://peps.python.org/pep-0498/) 引入了一种新型的字符串字面值: _f-字符串_ ，或称 [格式化字符串字面值](../reference/lexical_analysis.md#f-strings)。

格式化字符串字面值带有 `'f'` 前缀并且类似于 [`str.format()`](../library/stdtypes.md#str.format "str.format") 所接受的格式字符串。 其中包含由花括号包围的替换字段。 替换字段属于表达式，它们会在运行时被求值，然后使用 [`format()`](../library/functions.md#format "format") 协议进行格式化:
~~~
    
    
~~~shell
>>> name = "Fred"
>>> f"He said his name is {name}."
'He said his name is Fred.'
>>> width = 10
>>> precision = 4
>>> value = decimal.Decimal("12.34567")
>>> f"result: {value:{width}.{precision}}"  # nested fields
'result:      12.35'
~~~

参见

[**PEP 498**](https://peps.python.org/pep-0498/) \-- 字符串字面值插值。

    

~~~
PEP 由 Eric V. Smith 撰写并实现

[特性文档](../reference/lexical_analysis.md#f-strings)。

### PEP 526: 变量标注的语法¶

[**PEP 484**](https://peps.python.org/pep-0484/) 引入了函数形参类型标注即类型提示的标准。 这个 PEP 为 Python 添加了标注变量类型的语法，包括类变量和实例变量:
~~~
    
    
~~~
primes: List[int] = []

captain: str  # Note: no initial value!

class Starship:
    stats: Dict[str, int] = {}
~~~

与函数标注一样，Python 解释器不会为变量标注附加任何特殊含义，仅会将其保存在类或模块的 `__annotations__` 属性中。

与静态类型语法的变量声明不同，标注语法的目的是通过抽象语法树和 `__annotations__` 属性提供一个简单方式来为第三方工具和库指定结构化类型元数据。

参见

[**PEP 526**](https://peps.python.org/pep-0526/) \-- 变量标注的语法。

    

~~~
PEP 由 Ryan Gonzalez, Philip House, Ivan Levkivskyi, Lisa Roach, 和 Guido van Rossum 撰写，由 Ivan Levkivskyi 实现。

使用或将要使用此新语法的工具有: [mypy](https://www.mypy-lang.org/), [pytype](https://github.com/google/pytype), PyCharm 等等。

### PEP 515: 数字字面值中的下划线。¶

[**PEP 515**](https://peps.python.org/pep-0515/) 增加了在数字字面值中使用下划线的能力以改善可读性。 例如:
~~~
    
    
~~~shell
>>> 1_000_000_000_000_000
1000000000000000
>>> 0x_FF_FF_FF_FF
4294967295
~~~

单个下划线允许用在数码之间和任何数制指示符之后。 一行内不允许有开头、末尾或多个下划线。

[字符串格式化](string.md#formatspec) 微语言现在也支持以 `'_'` 选项来表示用下划线作为浮点表示类型和整数表示类型 `'d'` 的千位分隔符。 对于整数表示类型 `'b'`, `'o'`, `'x'` 和 `'X'`，将每隔 4 个数码插入一个下划线:

    
    
~~~shell
>>> '{:_}'.format(1000000)
'1_000_000'
>>> '{:_x}'.format(0xFFFFFFFF)
'ffff_ffff'
~~~

参见

[**PEP 515**](https://peps.python.org/pep-0515/) \-- 数字字面值中的下划线。

    

~~~
PEP 由 Georg Brandl 和 Serhiy Storchaka 撰写

### PEP 525: 异步生成器¶

[**PEP 492**](https://peps.python.org/pep-0492/) 将对原生协程和 `async` / `await` 语法的支持引入到 Python 3.5 中。 但 Python 3.5 实现的一个明显限制是不可能在同一函数体中同时使用 `await` 和 `yield`。 在 Python 3.6 中此限制已被解除，这样就就能够定义 _异步生成器_ :
~~~
    
    
~~~
async def ticker(delay, to):
    """Yield numbers from 0 to *to* every *delay* seconds."""
    for i in range(to):
        yield i
        await asyncio.sleep(delay)
~~~

这个新语法允许更快速且更精简的代码。

参见

[**PEP 525**](https://peps.python.org/pep-0525/) \-- 异步生成器

    

~~~
PEP 由 Yury Selivanov 撰写并实现

### PEP 530: 异步推导式¶

[**PEP 530**](https://peps.python.org/pep-0530/) 添加了对在列表、集合与字典推导式和生成器表达式中使用 `async for` 的支持:
~~~
    
    
~~~
result = [i async for i in aiter() if i % 2]
~~~

此外，`await` 表达式也在所有种类的推导式中得到支持:

    
    
~~~
result = [await fun() for fun in funcs if await condition()]
~~~

参见

[**PEP 530**](https://peps.python.org/pep-0530/) \-- 异步推导式

    

~~~
PEP 由 Yury Selivanov 撰写并实现

### PEP 487: 更简单的自定义类创建¶

现在可以在不使用元类的情况下自定义子类的创建。 当一个新的子类被创建时将在基类上调用新的 `__init_subclass__` 类方法:
~~~
    
    
~~~
class PluginBase:
    subclasses = []

    def __init_subclass__(cls, **kwargs):
        super().__init_subclass__(**kwargs)
        cls.subclasses.append(cls)

class Plugin1(PluginBase):
    pass

class Plugin2(PluginBase):
    pass
~~~

为了让来自 [`__init_subclass__()`](datamodel.md#object.__init_subclass__ "object.__init_subclass__") 实现的零参数 [`super()`](functions.md#super "super") 调用能正确工作，自定义元类必须保证新的 `__classcell__` 命名空间入口被传播到 `type.__new__` (如 [创建类对象](datamodel.md#class-object-creation) 中所描述)。

参见

[**PEP 487**](https://peps.python.org/pep-0487/) \-- 更简单的自定义类创建

    

~~~
PEP 由 Martin Teichmann 撰写并实现。

[特性文档](../reference/datamodel.md#class-customization)

### PEP 487: 描述器协议的增强¶

[**PEP 487**](https://peps.python.org/pep-0487/) 扩展了描述器协议以包括新的可选方法 [`__set_name__()`](../reference/datamodel.md#object.__set_name__ "object.__set_name__")。 当创建一个新类时，这个新方法将在定义中包括的所有描述器上被调用，为它们提供对所定义类的引用以及在类命名中间中给予描述器的名称。 换句话说，描述器的实例现在能知道描述器在所有者类中的属性名称:
~~~
    
    
~~~
class IntField:
    def __get__(self, instance, owner):
        return instance.__dict__[self.name]

    def __set__(self, instance, value):
        if not isinstance(value, int):
            raise ValueError(f'expecting integer in {self.name}')
        instance.__dict__[self.name] = value

    # this is the new initializer:
    def __set_name__(self, owner, name):
        self.name = name

class Model:
    int_field = IntField()
~~~

参见

[**PEP 487**](https://peps.python.org/pep-0487/) \-- 更简单的自定义类创建

    

~~~
PEP 由 Martin Teichmann 撰写并实现。

[特性文档](../reference/datamodel.md#descriptors)

### PEP 519: 添加文件系统路径协议¶

File system paths have historically been represented as [`str`](../library/stdtypes.md#str "str") or [`bytes`](../library/stdtypes.md#bytes "bytes") objects. This has led to people who write code which operate on file system paths to assume that such objects are only one of those two types (an [`int`](../library/functions.md#int "int") representing a file descriptor does not count as that is not a file path). Unfortunately that assumption prevents alternative object representations of file system paths like [`pathlib`](../library/pathlib.md#module-pathlib "pathlib: Object-oriented filesystem paths") from working with pre-existing code, including Python's standard library.

To fix this situation, a new interface represented by [`os.PathLike`](../library/os.md#os.PathLike "os.PathLike") has been defined. By implementing the [`__fspath__()`](../library/os.md#os.PathLike.__fspath__ "os.PathLike.__fspath__") method, an object signals that it represents a path. An object can then provide a low-level representation of a file system path as a [`str`](../library/stdtypes.md#str "str") or [`bytes`](../library/stdtypes.md#bytes "bytes") object. This means an object is considered [path-like](../glossary.md#term-path-like-object) if it implements [`os.PathLike`](../library/os.md#os.PathLike "os.PathLike") or is a [`str`](../library/stdtypes.md#str "str") or [`bytes`](../library/stdtypes.md#bytes "bytes") object which represents a file system path. Code can use [`os.fspath()`](../library/os.md#os.fspath "os.fspath"), [`os.fsdecode()`](../library/os.md#os.fsdecode "os.fsdecode"), or [`os.fsencode()`](../library/os.md#os.fsencode "os.fsencode") to explicitly get a [`str`](../library/stdtypes.md#str "str") and/or [`bytes`](../library/stdtypes.md#bytes "bytes") representation of a path-like object.

The built-in [`open()`](../library/functions.md#open "open") function has been updated to accept [`os.PathLike`](../library/os.md#os.PathLike "os.PathLike") objects, as have all relevant functions in the [`os`](../library/os.md#module-os "os: Miscellaneous operating system interfaces.") and [`os.path`](../library/os.path.md#module-os.path "os.path: Operations on pathnames.") modules, and most other functions and classes in the standard library. The [`os.DirEntry`](../library/os.md#os.DirEntry "os.DirEntry") class and relevant classes in [`pathlib`](../library/pathlib.md#module-pathlib "pathlib: Object-oriented filesystem paths") have also been updated to implement [`os.PathLike`](../library/os.md#os.PathLike "os.PathLike").

The hope is that updating the fundamental functions for operating on file system paths will lead to third-party code to implicitly support all [path-like objects](../glossary.md#term-path-like-object) without any code changes, or at least very minimal ones (e.g. calling [`os.fspath()`](../library/os.md#os.fspath "os.fspath") at the beginning of code before operating on a path-like object).

Here are some examples of how the new interface allows for [`pathlib.Path`](../library/pathlib.md#pathlib.Path "pathlib.Path") to be used more easily and transparently with pre-existing code:
~~~
    
    
~~~shell
>>> import pathlib
>>> with open(pathlib.Path("README")) as f:
...     contents = f.read()
...
>>> import os.path
>>> os.path.splitext(pathlib.Path("some_file.txt"))
('some_file', '.txt')
>>> os.path.join("/a/b", pathlib.Path("c"))
'/a/b/c'
>>> import os
>>> os.fspath(pathlib.Path("some_file.txt"))
'some_file.txt'
~~~

（由 Brett Cannon, Ethan Furman, Dusty Phillips 和 Jelle Zijlstra 实现。）

参见

[**PEP 519**](https://peps.python.org/pep-0519/) \-- 添加文件系统路径协议

    

~~~
PEP 由 Brett Cannon 和 Koos Zevenhoven 撰写。

### PEP 495: 消除本地时间的歧义¶

In most world locations, there have been and will be times when local clocks are moved back. In those times, intervals are introduced in which local clocks show the same time twice in the same day. In these situations, the information displayed on a local clock (or stored in a Python datetime instance) is insufficient to identify a particular moment in time.

[**PEP 495**](https://peps.python.org/pep-0495/) adds the new _fold_ attribute to instances of [`datetime.datetime`](../library/datetime.md#datetime.datetime "datetime.datetime") and [`datetime.time`](../library/datetime.md#datetime.time "datetime.time") classes to differentiate between two moments in time for which local times are the same:
~~~
    
    
~~~shell
>>> u0 = datetime(2016, 11, 6, 4, tzinfo=timezone.utc)
>>> for i in range(4):
...     u = u0 + i*HOUR
...     t = u.astimezone(Eastern)
...     print(u.time(), 'UTC =', t.time(), t.tzname(), t.fold)
...
04:00:00 UTC = 00:00:00 EDT 0
05:00:00 UTC = 01:00:00 EDT 0
06:00:00 UTC = 01:00:00 EST 1
07:00:00 UTC = 02:00:00 EST 0
~~~

The values of the [`fold`](3.标准库/datetime.md#datetime.datetime.fold "datetime.datetime.fold") attribute have the value `0` for all instances except those that represent the second (chronologically) moment in time in an ambiguous case.

参见

[**PEP 495**](https://peps.python.org/pep-0495/) \-- 消除本地时间的歧义

    

~~~
PEP 由 Alexander Belopolsky 和 Tim Peters 撰写，由 Alexander Belopolsky 实现。

### PEP 529: 将Windows文件系统编码更改为UTF-8¶

Representing filesystem paths is best performed with str (Unicode) rather than bytes. However, there are some situations where using bytes is sufficient and correct.

Prior to Python 3.6, data loss could result when using bytes paths on Windows. With this change, using bytes to represent paths is now supported on Windows, provided those bytes are encoded with the encoding returned by [`sys.getfilesystemencoding()`](../library/sys.md#sys.getfilesystemencoding "sys.getfilesystemencoding"), which now defaults to `'utf-8'`.

Applications that do not use str to represent paths should use [`os.fsencode()`](../library/os.md#os.fsencode "os.fsencode") and [`os.fsdecode()`](../library/os.md#os.fsdecode "os.fsdecode") to ensure their bytes are correctly encoded. To revert to the previous behaviour, set [`PYTHONLEGACYWINDOWSFSENCODING`](../using/cmdline.md#envvar-PYTHONLEGACYWINDOWSFSENCODING) or call [`sys._enablelegacywindowsfsencoding()`](../library/sys.md#sys._enablelegacywindowsfsencoding "sys._enablelegacywindowsfsencoding").

有关详细信息和可能需要的代码修改的讨论，请参见 [**PEP 529**](https://peps.python.org/pep-0529/) 。

### PEP 528: 将Windows控制台编码更改为UTF-8¶

The default console on Windows will now accept all Unicode characters and provide correctly read str objects to Python code. `sys.stdin`, `sys.stdout` and `sys.stderr` now default to utf-8 encoding.

This change only applies when using an interactive console, and not when redirecting files or pipes. To revert to the previous behaviour for interactive console use, set [`PYTHONLEGACYWINDOWSSTDIO`](../using/cmdline.md#envvar-PYTHONLEGACYWINDOWSSTDIO).

参见

[**PEP 528**](https://peps.python.org/pep-0528/) \-- 将Windows控制台编码更改为UTF-8
~~~
    

~~~
PEP 由 Steve Dower 撰写并实现。

### PEP 520: 保留类属性定义顺序¶

类定义体中的属性具有自然的排序：与名称在源代码中出现的顺序相同。 现在此排序会在新类的 [`__dict__`](../library/stdtypes.md#object.__dict__ "object.__dict__") 属性中被保留。

并且，实际的默认类 _execution_ 命名空间 (从 [type.__prepare__()](../reference/datamodel.md#prepare) 返回) 现在将是一个保留插入顺序的映射对象。

参见

[**PEP 520**](https://peps.python.org/pep-0520/) \-- 保留类属性定义顺序
~~~
    

~~~
PEP 由 Eric Snow 撰写并实现

### PEP 468: 保留关键字参数顺序¶

函数签名中的 `**kwargs` 现在将保证是一个保留插入顺序的映射对象。

参见

[**PEP 468**](https://peps.python.org/pep-0468/) \-- 保留关键字参数顺序
~~~
    

~~~
PEP 由 Eric Snow 撰写并实现

### 新的 [dict](../library/stdtypes.md#typesmapping) 实现¶

The [dict](../library/stdtypes.md#typesmapping) type now uses a "compact" representation based on [a proposal by Raymond Hettinger](https://mail.python.org/pipermail/python-dev/2012-December/123028.md) which was [first implemented by PyPy](https://morepypy.blogspot.com/2015/01/faster-more-memory-efficient-and-more.md). The memory usage of the new [`dict()`](../library/stdtypes.md#dict "dict") is between 20% and 25% smaller compared to Python 3.5.

The order-preserving aspect of this new implementation is considered an implementation detail and should not be relied upon (this may change in the future, but it is desired to have this new dict implementation in the language for a few releases before changing the language spec to mandate order-preserving semantics for all current and future Python implementations; this also helps preserve backwards-compatibility with older versions of the language where random iteration order is still in effect, e.g. Python 3.5).

(Contributed by INADA Naoki in [bpo-27350](https://bugs.python.org/issue?@action=redirect&bpo=27350). Idea [originally suggested by Raymond Hettinger](https://mail.python.org/pipermail/python-dev/2012-December/123028.md).)

### PEP 523: 向CPython 添加框架评估API¶

While Python provides extensive support to customize how code executes, one place it has not done so is in the evaluation of frame objects. If you wanted some way to intercept frame evaluation in Python there really wasn't any way without directly manipulating function pointers for defined functions.

[**PEP 523**](https://peps.python.org/pep-0523/) changes this by providing an API to make frame evaluation pluggable at the C level. This will allow for tools such as debuggers and JITs to intercept frame evaluation before the execution of Python code begins. This enables the use of alternative evaluation implementations for Python code, tracking frame evaluation, etc.

This API is not part of the limited C API and is marked as private to signal that usage of this API is expected to be limited and only applicable to very select, low-level use-cases. Semantics of the API will change with Python as necessary.

参见

[**PEP 523**](https://peps.python.org/pep-0523/) \-- 向CPython 添加框架评估API
~~~
    

~~~
PEP 由 Brett Cannon 和 Dino Viehland 撰写。

### PYTHONMALLOC 环境变量¶

新的 [`PYTHONMALLOC`](../using/cmdline.md#envvar-PYTHONMALLOC) 环境变量允许设置 Python 内存分配器并安装调试钩子。

现在将可以使用 `PYTHONMALLOC=debug` 在以发布模式编译的 Python 上为 Python 内存分配器安装调试钩子。 调试钩子的效果:

  * 新分配的内存中填充字节 `0xCB`

  * 释放的内存中填充了字节 `0xDB`

  * 检测违反 Python 内存分配器 API 的操作。 例如，[`PyObject_Free()`](../c-api/memory.md#c.PyObject_Free "PyObject_Free") 在 [`PyMem_Malloc()`](../c-api/memory.md#c.PyMem_Malloc "PyMem_Malloc") 所分配的内存块上被调用。

  * 在缓冲区开始之前检测写操作（缓冲区下溢）

  * 在缓冲区结束后检测写操作（缓冲区溢出）

  * 检测当调用 [`PYMEM_DOMAIN_OBJ`](../c-api/memory.md#c.PYMEM_DOMAIN_OBJ "PYMEM_DOMAIN_OBJ") (如: [`PyObject_Malloc()`](../c-api/memory.md#c.PyObject_Malloc "PyObject_Malloc")) 和 [`PYMEM_DOMAIN_MEM`](../c-api/memory.md#c.PYMEM_DOMAIN_MEM "PYMEM_DOMAIN_MEM") (如: [`PyMem_Malloc()`](../c-api/memory.md#c.PyMem_Malloc "PyMem_Malloc")) 域的分配器函数时是否持有 [GIL](../glossary.md#term-global-interpreter-lock)。

检查是否保留了 GIL 也是Python 3.6 的新特性。

请参阅 [`PyMem_SetupDebugHooks()`](../c-api/memory.md#c.PyMem_SetupDebugHooks "PyMem_SetupDebugHooks") 函数来了解 Python 内存分配器上的调试钩子。

现在还可以使用 `PYTHONMALLOC=malloc` 为所有的 Python 内存分配强制使用 C 库的 `malloc()` 分配器。 这在以发布模式编译的 Python 上使用外部内存调试器如 Valgrind 时会很有用处。

发生错误时，Python 内存分配器上的调试钩子现在会使用 [`tracemalloc`](../library/tracemalloc.md#module-tracemalloc "tracemalloc: Trace memory allocations.") 模块来获取内存块被分配所在位置上的回溯。

使用 `python3.6 -X tracemalloc=5` (在回溯中存储 5 帧) 的缓冲区溢出的致命错误示例:
~~~
    
    
~~~
Debug memory block at address p=0x7fbcd41666f8: API 'o'
    4 bytes originally requested
    The 7 pad bytes at p-7 are FORBIDDENBYTE, as expected.
    The 8 pad bytes at tail=0x7fbcd41666fc are not all FORBIDDENBYTE (0xfb):
        at tail+0: 0x02 *** OUCH
        at tail+1: 0xfb
        at tail+2: 0xfb
        at tail+3: 0xfb
        at tail+4: 0xfb
        at tail+5: 0xfb
        at tail+6: 0xfb
        at tail+7: 0xfb
    The block was made by call #1233329 to debug malloc/realloc.
    Data at p: 1a 2b 30 00

Memory block allocated at (most recent call first):
  File "test/test_bytes.py", line 323
  File "unittest/case.py", line 600
  File "unittest/case.py", line 648
  File "unittest/suite.py", line 122
  File "unittest/suite.py", line 84

Fatal Python error: bad trailing pad byte

Current thread 0x00007fbcdbd32700 (most recent call first):
  File "test/test_bytes.py", line 323 in test_hex
  File "unittest/case.py", line 600 in run
  File "unittest/case.py", line 648 in __call__
  File "unittest/suite.py", line 122 in run
  File "unittest/suite.py", line 84 in __call__
  File "unittest/suite.py", line 122 in run
  File "unittest/suite.py", line 84 in __call__
  ...
~~~

（由 Victor Stinner 在 [bpo-26516](https://bugs.python.org/issue?@action=redirect&bpo=26516) 和 [bpo-26564](https://bugs.python.org/issue?@action=redirect&bpo=26564) 中贡献。）

### DTrace 和 SystemTap 探测支持¶

Python 现在可以附带 `--with-dtrace` 来构建以便为解释器中的下列事件启用静态标记:

  * 函数调用/返回

  * 垃圾收集开始/完成

  * 执行的代码行。

这可被用来在生产环境中控制正在运行的解释器，而无需重新编译特定的 [调试版本](configure.md#debug-build) 或提供应用专属的性能分析/调试代码。

更多信息，请参见 [使用 DTrace 和 SystemTap 检测CPython](instrumentation.md#instrumentation) 。

当前的实现已在 Linux 和 macOS 上进行了测试。将来可能会添加其他标记。

（由 Łukasz Langa 在 [bpo-21590](https://bugs.python.org/issue?@action=redirect&bpo=21590) 中贡献，基于 Jesús Cea Avión, David Malcolm 和 Nikhil Benesch 的补丁。）

## 其他语言特性修改¶

对Python 语言核心进行的小改动：

  * A `global` or `nonlocal` statement must now textually appear before the first use of the affected name in the same scope. Previously this was a [`SyntaxWarning`](3.标准库/exceptions.md#SyntaxWarning "SyntaxWarning").

  * It is now possible to set a [special method](datamodel.md#specialnames) to `None` to indicate that the corresponding operation is not available. For example, if a class sets `__iter__()` to `None`, the class is not iterable. (Contributed by Andrew Barnert and Ivan Levkivskyi in [bpo-25958](https://bugs.python.org/issue?@action=redirect&bpo=25958).)

  * Long sequences of repeated traceback lines are now abbreviated as `"[Previous line repeated {count} more times]"` (see 回溯 for an example). (Contributed by Emanuel Barry in [bpo-26823](https://bugs.python.org/issue?@action=redirect&bpo=26823).)

  * Import now raises the new exception [`ModuleNotFoundError`](3.标准库/exceptions.md#ModuleNotFoundError "ModuleNotFoundError") (subclass of [`ImportError`](3.标准库/exceptions.md#ImportError "ImportError")) when it cannot find a module. Code that currently checks for ImportError (in try-except) will still work. (Contributed by Eric Snow in [bpo-15767](https://bugs.python.org/issue?@action=redirect&bpo=15767).)

  * Class methods relying on zero-argument `super()` will now work correctly when called from metaclass methods during class creation. (Contributed by Martin Teichmann in [bpo-23722](https://bugs.python.org/issue?@action=redirect&bpo=23722).)

## 新增模块¶

### secrets¶

The main purpose of the new [`secrets`](secrets.md#module-secrets "secrets: Generate secure random numbers for managing secrets.") module is to provide an obvious way to reliably generate cryptographically strong pseudo-random values suitable for managing secrets, such as account authentication, tokens, and similar.

警告

Note that the pseudo-random generators in the [`random`](random.md#module-random "random: Generate pseudo-random numbers with various common distributions.") module should _NOT_ be used for security purposes. Use [`secrets`](secrets.md#module-secrets "secrets: Generate secure random numbers for managing secrets.") on Python 3.6+ and [`os.urandom()`](os.md#os.urandom "os.urandom") on Python 3.5 and earlier.

参见

[**PEP 506**](https://peps.python.org/pep-0506/) \-- Secrets模块被加入Python标准库

    

~~~
PEP 由 Steven D'Aprano 撰写并实现。

## 改进的模块¶

### array¶

Exhausted iterators of [`array.array`](../library/array.md#array.array "array.array") will now stay exhausted even if the iterated array is extended. This is consistent with the behavior of other mutable sequences.

由 Serhiy Storchaka 在 [bpo-26492](https://bugs.python.org/issue?@action=redirect&bpo=26492) 中贡献。

### ast¶

The new [`ast.Constant`](../library/ast.md#ast.Constant "ast.Constant") AST node has been added. It can be used by external AST optimizers for the purposes of constant folding.

由 Victor Stinner 在 [bpo-26146](https://bugs.python.org/issue?@action=redirect&bpo=26146) 中贡献。

### asyncio¶

Starting with Python 3.6 the `asyncio` module is no longer provisional and its API is considered stable.

Notable changes in the [`asyncio`](../library/asyncio.md#module-asyncio "asyncio: Asynchronous I/O.") module since Python 3.5.0 (all backported to 3.5.x due to the provisional status):

  * The [`get_event_loop()`](../library/asyncio-eventloop.md#asyncio.get_event_loop "asyncio.get_event_loop") function has been changed to always return the currently running loop when called from coroutines and callbacks. (Contributed by Yury Selivanov in [bpo-28613](https://bugs.python.org/issue?@action=redirect&bpo=28613).)

  * The [`ensure_future()`](../library/asyncio-future.md#asyncio.ensure_future "asyncio.ensure_future") function and all functions that use it, such as [`loop.run_until_complete()`](../library/asyncio-eventloop.md#asyncio.loop.run_until_complete "asyncio.loop.run_until_complete"), now accept all kinds of [awaitable objects](../glossary.md#term-awaitable). (Contributed by Yury Selivanov.)

  * 新增 [`run_coroutine_threadsafe()`](../library/asyncio-task.md#asyncio.run_coroutine_threadsafe "asyncio.run_coroutine_threadsafe") 函数用于从其他线程向事件循环提交协程。（由 Vincent Michel 贡献。）

  * 新增 [`Transport.is_closing()`](../library/asyncio-protocol.md#asyncio.BaseTransport.is_closing "asyncio.BaseTransport.is_closing") 方法用于检查传输是否正在关闭或已经关闭。 （由 Yury Selivanov 贡献。）

  * [`loop.create_server()`](../library/asyncio-eventloop.md#asyncio.loop.create_server "asyncio.loop.create_server") 方法现在可以接受一个主机列表。 （由 Yann Sionneau 贡献。）

  * New [`loop.create_future()`](../library/asyncio-eventloop.md#asyncio.loop.create_future "asyncio.loop.create_future") method to create Future objects. This allows alternative event loop implementations, such as [uvloop](https://github.com/MagicStack/uvloop), to provide a faster [`asyncio.Future`](../library/asyncio-future.md#asyncio.Future "asyncio.Future") implementation. (Contributed by Yury Selivanov in [bpo-27041](https://bugs.python.org/issue?@action=redirect&bpo=27041).)

  * New [`loop.get_exception_handler()`](../library/asyncio-eventloop.md#asyncio.loop.get_exception_handler "asyncio.loop.get_exception_handler") method to get the current exception handler. (Contributed by Yury Selivanov in [bpo-27040](https://bugs.python.org/issue?@action=redirect&bpo=27040).)

  * New [`StreamReader.readuntil()`](../library/asyncio-stream.md#asyncio.StreamReader.readuntil "asyncio.StreamReader.readuntil") method to read data from the stream until a separator bytes sequence appears. (Contributed by Mark Korenberg.)

  * The performance of [`StreamReader.readexactly()`](../library/asyncio-stream.md#asyncio.StreamReader.readexactly "asyncio.StreamReader.readexactly") has been improved. (Contributed by Mark Korenberg in [bpo-28370](https://bugs.python.org/issue?@action=redirect&bpo=28370).)

  * The [`loop.getaddrinfo()`](../library/asyncio-eventloop.md#asyncio.loop.getaddrinfo "asyncio.loop.getaddrinfo") method is optimized to avoid calling the system `getaddrinfo` function if the address is already resolved. (Contributed by A. Jesse Jiryu Davis.)

  * The [`loop.stop()`](../library/asyncio-eventloop.md#asyncio.loop.stop "asyncio.loop.stop") method has been changed to stop the loop immediately after the current iteration. Any new callbacks scheduled as a result of the last iteration will be discarded. (Contributed by Guido van Rossum in [bpo-25593](https://bugs.python.org/issue?@action=redirect&bpo=25593).)

  * `Future.set_exception` will now raise [`TypeError`](../library/exceptions.md#TypeError "TypeError") when passed an instance of the [`StopIteration`](../library/exceptions.md#StopIteration "StopIteration") exception. (Contributed by Chris Angelico in [bpo-26221](https://bugs.python.org/issue?@action=redirect&bpo=26221).)

  * New [`loop.connect_accepted_socket()`](../library/asyncio-eventloop.md#asyncio.loop.connect_accepted_socket "asyncio.loop.connect_accepted_socket") method to be used by servers that accept connections outside of asyncio, but that use asyncio to handle them. (Contributed by Jim Fulton in [bpo-27392](https://bugs.python.org/issue?@action=redirect&bpo=27392).)

  * `TCP_NODELAY` flag is now set for all TCP transports by default. (Contributed by Yury Selivanov in [bpo-27456](https://bugs.python.org/issue?@action=redirect&bpo=27456).)

  * New [`loop.shutdown_asyncgens()`](../library/asyncio-eventloop.md#asyncio.loop.shutdown_asyncgens "asyncio.loop.shutdown_asyncgens") to properly close pending asynchronous generators before closing the loop. (Contributed by Yury Selivanov in [bpo-28003](https://bugs.python.org/issue?@action=redirect&bpo=28003).)

  * [`Future`](../library/asyncio-future.md#asyncio.Future "asyncio.Future") and [`Task`](../library/asyncio-task.md#asyncio.Task "asyncio.Task") classes now have an optimized C implementation which makes asyncio code up to 30% faster. (Contributed by Yury Selivanov and INADA Naoki in [bpo-26081](https://bugs.python.org/issue?@action=redirect&bpo=26081) and [bpo-28544](https://bugs.python.org/issue?@action=redirect&bpo=28544).)

### binascii¶

The [`b2a_base64()`](../library/binascii.md#binascii.b2a_base64 "binascii.b2a_base64") function now accepts an optional _newline_ keyword argument to control whether the newline character is appended to the return value. (Contributed by Victor Stinner in [bpo-25357](https://bugs.python.org/issue?@action=redirect&bpo=25357).)

### cmath¶

The new [`cmath.tau`](../library/cmath.md#cmath.tau "cmath.tau") ( _τ_ ) constant has been added. (Contributed by Lisa Roach in [bpo-12345](https://bugs.python.org/issue?@action=redirect&bpo=12345), see [**PEP 628**](https://peps.python.org/pep-0628/) for details.)

New constants: [`cmath.inf`](../library/cmath.md#cmath.inf "cmath.inf") and [`cmath.nan`](../library/cmath.md#cmath.nan "cmath.nan") to match [`math.inf`](../library/math.md#math.inf "math.inf") and [`math.nan`](../library/math.md#math.nan "math.nan"), and also [`cmath.infj`](../library/cmath.md#cmath.infj "cmath.infj") and [`cmath.nanj`](../library/cmath.md#cmath.nanj "cmath.nanj") to match the format used by complex repr. (Contributed by Mark Dickinson in [bpo-23229](https://bugs.python.org/issue?@action=redirect&bpo=23229).)

### collections¶

The new [`Collection`](../library/collections.abc.md#collections.abc.Collection "collections.abc.Collection") abstract base class has been added to represent sized iterable container classes. (Contributed by Ivan Levkivskyi, docs by Neil Girdhar in [bpo-27598](https://bugs.python.org/issue?@action=redirect&bpo=27598).)

The new [`Reversible`](../library/collections.abc.md#collections.abc.Reversible "collections.abc.Reversible") abstract base class represents iterable classes that also provide the `__reversed__()` method. (Contributed by Ivan Levkivskyi in [bpo-25987](https://bugs.python.org/issue?@action=redirect&bpo=25987).)

新增代表异步生成器的 [`AsyncGenerator`](../library/collections.abc.md#collections.abc.AsyncGenerator "collections.abc.AsyncGenerator") 抽象基类。 （由 Yury Selivanov 在 [bpo-28720](https://bugs.python.org/issue?@action=redirect&bpo=28720) 中贡献。）

The [`namedtuple()`](../library/collections.md#collections.namedtuple "collections.namedtuple") function now accepts an optional keyword argument _module_ , which, when specified, is used for the `__module__` attribute of the returned named tuple class. (Contributed by Raymond Hettinger in [bpo-17941](https://bugs.python.org/issue?@action=redirect&bpo=17941).)

The _verbose_ and _rename_ arguments for [`namedtuple()`](../library/collections.md#collections.namedtuple "collections.namedtuple") are now keyword-only. (Contributed by Raymond Hettinger in [bpo-25628](https://bugs.python.org/issue?@action=redirect&bpo=25628).)

Recursive [`collections.deque`](../library/collections.md#collections.deque "collections.deque") instances can now be pickled. (Contributed by Serhiy Storchaka in [bpo-26482](https://bugs.python.org/issue?@action=redirect&bpo=26482).)

### concurrent.futures¶

The [`ThreadPoolExecutor`](../library/concurrent.futures.md#concurrent.futures.ThreadPoolExecutor "concurrent.futures.ThreadPoolExecutor") class constructor now accepts an optional _thread_name_prefix_ argument to make it possible to customize the names of the threads created by the pool. (Contributed by Gregory P. Smith in [bpo-27664](https://bugs.python.org/issue?@action=redirect&bpo=27664).)

### contextlib¶

The [`contextlib.AbstractContextManager`](../library/contextlib.md#contextlib.AbstractContextManager "contextlib.AbstractContextManager") class has been added to provide an abstract base class for context managers. It provides a sensible default implementation for `__enter__()` which returns `self` and leaves `__exit__()` an abstract method. A matching class has been added to the [`typing`](../library/typing.md#module-typing "typing: Support for type hints \(see :pep:`484`\).") module as [`typing.ContextManager`](../library/typing.md#typing.ContextManager "typing.ContextManager"). (Contributed by Brett Cannon in [bpo-25609](https://bugs.python.org/issue?@action=redirect&bpo=25609).)

### datetime¶

The [`datetime`](../library/datetime.md#datetime.datetime "datetime.datetime") and [`time`](../library/datetime.md#datetime.time "datetime.time") classes have the new `fold` attribute used to disambiguate local time when necessary. Many functions in the [`datetime`](../library/datetime.md#module-datetime "datetime: Basic date and time types.") have been updated to support local time disambiguation. See Local Time Disambiguation section for more information. (Contributed by Alexander Belopolsky in [bpo-24773](https://bugs.python.org/issue?@action=redirect&bpo=24773).)

The [`datetime.strftime()`](../library/datetime.md#datetime.datetime.strftime "datetime.datetime.strftime") and [`date.strftime()`](../library/datetime.md#datetime.date.strftime "datetime.date.strftime") methods now support ISO 8601 date directives `%G`, `%u` and `%V`. (Contributed by Ashley Anderson in [bpo-12006](https://bugs.python.org/issue?@action=redirect&bpo=12006).)

The [`datetime.isoformat()`](../library/datetime.md#datetime.datetime.isoformat "datetime.datetime.isoformat") function now accepts an optional _timespec_ argument that specifies the number of additional components of the time value to include. (Contributed by Alessandro Cucci and Alexander Belopolsky in [bpo-19475](https://bugs.python.org/issue?@action=redirect&bpo=19475).)

The [`datetime.combine()`](../library/datetime.md#datetime.datetime.combine "datetime.datetime.combine") now accepts an optional _tzinfo_ argument. (Contributed by Alexander Belopolsky in [bpo-27661](https://bugs.python.org/issue?@action=redirect&bpo=27661).)

### decimal¶

New [`Decimal.as_integer_ratio()`](../library/decimal.md#decimal.Decimal.as_integer_ratio "decimal.Decimal.as_integer_ratio") method that returns a pair `(n, d)` of integers that represent the given [`Decimal`](../library/decimal.md#decimal.Decimal "decimal.Decimal") instance as a fraction, in lowest terms and with a positive denominator:
~~~
    
    
~~~shell
>>> Decimal('-3.14').as_integer_ratio()
(-157, 50)
~~~

（由 Stefan Krah 和 Mark Dickinson 在 [bpo-25928](https://bugs.python.org/issue?@action=redirect&bpo=25928) 中贡献。）

### distutils¶

The `default_format` attribute has been removed from `distutils.command.sdist.sdist` and the `formats` attribute defaults to `['gztar']`. Although not anticipated, any code relying on the presence of `default_format` may need to be adapted. See [bpo-27819](https://bugs.python.org/issue?@action=redirect&bpo=27819) for more details.

### email¶

The new email API, enabled via the _policy_ keyword to various constructors, is no longer provisional. The [`email`](email.md#module-email "email: Package supporting the parsing, manipulating, and generating email messages.") documentation has been reorganized and rewritten to focus on the new API, while retaining the old documentation for the legacy API. (Contributed by R. David Murray in [bpo-24277](https://bugs.python.org/issue?@action=redirect&bpo=24277).)

The [`email.mime`](email.mime.md#module-email.mime "email.mime: Build MIME messages.") classes now all accept an optional _policy_ keyword. (Contributed by Berker Peksag in [bpo-27331](https://bugs.python.org/issue?@action=redirect&bpo=27331).)

[`DecodedGenerator`](email.generator.md#email.generator.DecodedGenerator "email.generator.DecodedGenerator") 现在支持 _policy_ 关键字。

There is a new [`policy`](email.policy.md#module-email.policy "email.policy: Controlling the parsing and generating of messages") attribute, [`message_factory`](email.policy.md#email.policy.Policy.message_factory "email.policy.Policy.message_factory"), that controls what class is used by default when the parser creates new message objects. For the [`email.policy.compat32`](email.policy.md#email.policy.compat32 "email.policy.compat32") policy this is [`Message`](email.compat32-message.md#email.message.Message "email.message.Message"), for the new policies it is [`EmailMessage`](email.message.md#email.message.EmailMessage "email.message.EmailMessage"). (Contributed by R. David Murray in [bpo-20476](https://bugs.python.org/issue?@action=redirect&bpo=20476).)

### encodings¶

On Windows, added the `'oem'` encoding to use `CP_OEMCP`, and the `'ansi'` alias for the existing `'mbcs'` encoding, which uses the `CP_ACP` code page. (Contributed by Steve Dower in [bpo-27959](https://bugs.python.org/issue?@action=redirect&bpo=27959).)

### enum¶

Two new enumeration base classes have been added to the [`enum`](3.标准库/enum.md#module-enum "enum: Implementation of an enumeration class.") module: [`Flag`](3.标准库/enum.md#enum.Flag "enum.Flag") and `IntFlags`. Both are used to define constants that can be combined using the bitwise operators. (Contributed by Ethan Furman in [bpo-23591](https://bugs.python.org/issue?@action=redirect&bpo=23591).)

Many standard library modules have been updated to use the `IntFlags` class for their constants.

The new [`enum.auto`](3.标准库/enum.md#enum.auto "enum.auto") value can be used to assign values to enum members automatically:

    
    
~~~shell
>>> from enum import Enum, auto
>>> class Color(Enum):
...     red = auto()
...     blue = auto()
...     green = auto()
...
>>> list(Color)
[<Color.red: 1>, <Color.blue: 2>, <Color.green: 3>]
~~~

### faulthandler¶

On Windows, the [`faulthandler`](faulthandler.md#module-faulthandler "faulthandler: Dump the Python traceback.") module now installs a handler for Windows exceptions: see [`faulthandler.enable()`](faulthandler.md#faulthandler.enable "faulthandler.enable"). (Contributed by Victor Stinner in [bpo-23848](https://bugs.python.org/issue?@action=redirect&bpo=23848).)

### fileinput¶

[`hook_encoded()`](fileinput.md#fileinput.hook_encoded "fileinput.hook_encoded") 现在支持 _errors_ 参数。 （由 Joseph Hackman 在 [bpo-25788](https://bugs.python.org/issue?@action=redirect&bpo=25788) 中贡献。）

### hashlib¶

[`hashlib`](hashlib.md#module-hashlib "hashlib: Secure hash and message digest algorithms.") supports OpenSSL 1.1.0. The minimum recommend version is 1.0.2. (Contributed by Christian Heimes in [bpo-26470](https://bugs.python.org/issue?@action=redirect&bpo=26470).)

BLAKE2 hash functions were added to the module. [`blake2b()`](hashlib.md#hashlib.blake2b "hashlib.blake2b") and [`blake2s()`](hashlib.md#hashlib.blake2s "hashlib.blake2s") are always available and support the full feature set of BLAKE2. (Contributed by Christian Heimes in [bpo-26798](https://bugs.python.org/issue?@action=redirect&bpo=26798) based on code by Dmitry Chestnykh and Samuel Neves. Documentation written by Dmitry Chestnykh.)

The SHA-3 hash functions [`sha3_224()`](hashlib.md#hashlib.sha3_224 "hashlib.sha3_224"), [`sha3_256()`](hashlib.md#hashlib.sha3_256 "hashlib.sha3_256"), [`sha3_384()`](hashlib.md#hashlib.sha3_384 "hashlib.sha3_384"), [`sha3_512()`](hashlib.md#hashlib.sha3_512 "hashlib.sha3_512"), and SHAKE hash functions [`shake_128()`](hashlib.md#hashlib.shake_128 "hashlib.shake_128") and [`shake_256()`](hashlib.md#hashlib.shake_256 "hashlib.shake_256") were added. (Contributed by Christian Heimes in [bpo-16113](https://bugs.python.org/issue?@action=redirect&bpo=16113). Keccak Code Package by Guido Bertoni, Joan Daemen, Michaël Peeters, Gilles Van Assche, and Ronny Van Keer.)

The password-based key derivation function [`scrypt()`](hashlib.md#hashlib.scrypt "hashlib.scrypt") is now available with OpenSSL 1.1.0 and newer. (Contributed by Christian Heimes in [bpo-27928](https://bugs.python.org/issue?@action=redirect&bpo=27928).)

### http.client¶

[`HTTPConnection.request()`](http.client.md#http.client.HTTPConnection.request "http.client.HTTPConnection.request") and [`endheaders()`](http.client.md#http.client.HTTPConnection.endheaders "http.client.HTTPConnection.endheaders") both now support chunked encoding request bodies. (Contributed by Demian Brecht and Rolf Krahl in [bpo-12319](https://bugs.python.org/issue?@action=redirect&bpo=12319).)

### idlelib 与 IDLE¶

The idlelib package is being modernized and refactored to make IDLE look and work better and to make the code easier to understand, test, and improve. Part of making IDLE look better, especially on Linux and Mac, is using ttk widgets, mostly in the dialogs. As a result, IDLE no longer runs with tcl/tk 8.4. It now requires tcl/tk 8.5 or 8.6. We recommend running the latest release of either.

'Modernizing' includes renaming and consolidation of idlelib modules. The renaming of files with partial uppercase names is similar to the renaming of, for instance, Tkinter and TkFont to tkinter and tkinter.font in 3.0. As a result, imports of idlelib files that worked in 3.5 will usually not work in 3.6. At least a module name change will be needed (see idlelib/README.txt), sometimes more. (Name changes contributed by Al Swiegart and Terry Reedy in [bpo-24225](https://bugs.python.org/issue?@action=redirect&bpo=24225). Most idlelib patches since have been and will be part of the process.)

In compensation, the eventual result with be that some idlelib classes will be easier to use, with better APIs and docstrings explaining them. Additional useful information will be added to idlelib when available.

在 3.6.2 中新增:

多个对自动补全的修正。 （由 Louie Lu 在 [bpo-15786](https://bugs.python.org/issue?@action=redirect&bpo=15786) 中贡献。）

在 3.6.3 中新增:

Module Browser (在 File 菜单中，之前称为 Class Browser) 现在会在最高层级函数和类之外显示嵌套的函数和类。 （由 Guilherme Polo, Cheryl Sabella 和 Terry Jan Reedy 在 [bpo-1612262](https://bugs.python.org/issue?@action=redirect&bpo=1612262) 中贡献。）

之前以扩展形式实现的 IDLE 特性已作为正常特性重新实现。 它们的设置已从 Extensions 选项卡移至其他对话框选项卡。 （由 Charles Wohlganger 和 Terry Jan Reedy 在 [bpo-27099](https://bugs.python.org/issue?@action=redirect&bpo=27099) 中实现。）

Settings 对话框 (Options 中的 Configure IDLE) 已经被部分重写以改进外观和功能。 （由 Cheryl Sabella 和 Terry Jan Reedy 在多个问题项中贡献。）

在 3.6.4 中新增:

字体样本现在包括一组非拉丁字符以便用户能更好地查看所选特定字体的效果。 （由 Terry Jan Reedy 在 [bpo-13802](https://bugs.python.org/issue?@action=redirect&bpo=13802) 中贡献。） 样本可以被修改以包括其他字符。 （由 Serhiy Storchaka 在 [bpo-31860](https://bugs.python.org/issue?@action=redirect&bpo=31860) 中贡献。）

在 3.6.6 中新增:

编辑器代码上下文选项已经过修改。 Box 会显示所有上下文行直到最大行数。 点击一个上下文行会使编辑器跳转到该行。 自定义主题的上下文颜色已添加到 Settings 对话框的 Highlights 选项卡。 （由 Cheryl Sabella 和 Terry Jan Reedy 在 [bpo-33642](https://bugs.python.org/issue?@action=redirect&bpo=33642), [bpo-33768](https://bugs.python.org/issue?@action=redirect&bpo=33768) 和 [bpo-33679](https://bugs.python.org/issue?@action=redirect&bpo=33679) 中贡献。）

在 Windows 上，会有新的 API 调用将 tk 对 DPI 的调整告知 Windows。 在 Windows 8.1+ 或 10 上，如果 Python 二进制码的 DPI 兼容属性未改变，并且监视器分辨率大于 96 DPI，这应该会令文本和线条更清晰。 否则的话它应该不造成影响。 （由 Terry Jan Reedy 在 [bpo-33656](https://bugs.python.org/issue?@action=redirect&bpo=33656) 中贡献。）

在 3.6.7 中新增:

超过 N 行（默认值为 50）的输出将被折叠为一个按钮。 N 可以在 Settings 对话框的 General 页的 PyShell 部分中进行修改。 数量较少但是超长的行可以通过在输出上右击来折叠。 被折叠的输出可通过双击按钮来展开，或是通过右击按钮来放入剪贴板或是单独的窗口。 （由 Tal Einat 在 [bpo-1529353](https://bugs.python.org/issue?@action=redirect&bpo=1529353) 中贡献。）

### importlib¶

Import now raises the new exception [`ModuleNotFoundError`](3.标准库/exceptions.md#ModuleNotFoundError "ModuleNotFoundError") (subclass of [`ImportError`](3.标准库/exceptions.md#ImportError "ImportError")) when it cannot find a module. Code that current checks for `ImportError` (in try-except) will still work. (Contributed by Eric Snow in [bpo-15767](https://bugs.python.org/issue?@action=redirect&bpo=15767).)

[`importlib.util.LazyLoader`](importlib.md#importlib.util.LazyLoader "importlib.util.LazyLoader") now calls [`create_module()`](importlib.md#importlib.abc.Loader.create_module "importlib.abc.Loader.create_module") on the wrapped loader, removing the restriction that [`importlib.machinery.BuiltinImporter`](importlib.md#importlib.machinery.BuiltinImporter "importlib.machinery.BuiltinImporter") and [`importlib.machinery.ExtensionFileLoader`](importlib.md#importlib.machinery.ExtensionFileLoader "importlib.machinery.ExtensionFileLoader") couldn't be used with [`importlib.util.LazyLoader`](importlib.md#importlib.util.LazyLoader "importlib.util.LazyLoader").

[`importlib.util.cache_from_source()`](importlib.md#importlib.util.cache_from_source "importlib.util.cache_from_source"), [`importlib.util.source_from_cache()`](importlib.md#importlib.util.source_from_cache "importlib.util.source_from_cache"), and [`importlib.util.spec_from_file_location()`](importlib.md#importlib.util.spec_from_file_location "importlib.util.spec_from_file_location") now accept a [path-like object](../glossary.md#term-path-like-object).

### inspect¶

The [`inspect.signature()`](inspect.md#inspect.signature "inspect.signature") function now reports the implicit `.0` parameters generated by the compiler for comprehension and generator expression scopes as if they were positional-only parameters called `implicit0`. (Contributed by Jelle Zijlstra in [bpo-19611](https://bugs.python.org/issue?@action=redirect&bpo=19611).)

To reduce code churn when upgrading from Python 2.7 and the legacy `inspect.getargspec()` API, the previously documented deprecation of [`inspect.getfullargspec()`](inspect.md#inspect.getfullargspec "inspect.getfullargspec") has been reversed. While this function is convenient for single/source Python 2/3 code bases, the richer [`inspect.signature()`](inspect.md#inspect.signature "inspect.signature") interface remains the recommended approach for new code. (Contributed by Nick Coghlan in [bpo-27172](https://bugs.python.org/issue?@action=redirect&bpo=27172))

### json¶

[`json.load()`](json.md#json.load "json.load") and [`json.loads()`](json.md#json.loads "json.loads") now support binary input. Encoded JSON should be represented using either UTF-8, UTF-16, or UTF-32. (Contributed by Serhiy Storchaka in [bpo-17909](https://bugs.python.org/issue?@action=redirect&bpo=17909).)

### logging¶

The new [`WatchedFileHandler.reopenIfNeeded()`](logging.handlers.md#logging.handlers.WatchedFileHandler.reopenIfNeeded "logging.handlers.WatchedFileHandler.reopenIfNeeded") method has been added to add the ability to check if the log file needs to be reopened. (Contributed by Marian Horban in [bpo-24884](https://bugs.python.org/issue?@action=redirect&bpo=24884).)

### math¶

The tau ( _τ_ ) constant has been added to the [`math`](math.md#module-math "math: Mathematical functions \(sin\(\) etc.\).") and [`cmath`](cmath.md#module-cmath "cmath: Mathematical functions for complex numbers.") modules. (Contributed by Lisa Roach in [bpo-12345](https://bugs.python.org/issue?@action=redirect&bpo=12345), see [**PEP 628**](https://peps.python.org/pep-0628/) for details.)

### multiprocessing¶

[Proxy Objects](multiprocessing.md#multiprocessing-proxy-objects) returned by [`multiprocessing.Manager()`](multiprocessing.md#multiprocessing.Manager "multiprocessing.Manager") can now be nested. (Contributed by Davin Potts in [bpo-6766](https://bugs.python.org/issue?@action=redirect&bpo=6766).)

### os¶

See the summary of PEP 519 for details on how the [`os`](os.md#module-os "os: Miscellaneous operating system interfaces.") and [`os.path`](os.path.md#module-os.path "os.path: Operations on pathnames.") modules now support [path-like objects](../glossary.md#term-path-like-object).

[`scandir()`](os.md#os.scandir "os.scandir") now supports [`bytes`](stdtypes.md#bytes "bytes") paths on Windows.

A new [`close()`](os.md#os.scandir.close "os.scandir.close") method allows explicitly closing a [`scandir()`](os.md#os.scandir "os.scandir") iterator. The [`scandir()`](os.md#os.scandir "os.scandir") iterator now supports the [context manager](../glossary.md#term-context-manager) protocol. If a `scandir()` iterator is neither exhausted nor explicitly closed a [`ResourceWarning`](3.标准库/exceptions.md#ResourceWarning "ResourceWarning") will be emitted in its destructor. (Contributed by Serhiy Storchaka in [bpo-25994](https://bugs.python.org/issue?@action=redirect&bpo=25994).)

在 Linux 上，现在 [`os.urandom()`](os.md#os.urandom "os.urandom") 会阻塞直到系统的 urandom 熵池被初始化以提升安全性。 其理由参见 [**PEP 524**](https://peps.python.org/pep-0524/)。

The Linux `getrandom()` syscall (get random bytes) is now exposed as the new [`os.getrandom()`](os.md#os.getrandom "os.getrandom") function. (Contributed by Victor Stinner, part of the [**PEP 524**](https://peps.python.org/pep-0524/))

### pathlib¶

[`pathlib`](pathlib.md#module-pathlib "pathlib: Object-oriented filesystem paths") now supports [path-like objects](../glossary.md#term-path-like-object). (Contributed by Brett Cannon in [bpo-27186](https://bugs.python.org/issue?@action=redirect&bpo=27186).)

See the summary of PEP 519 for details.

### pdb¶

The [`Pdb`](pdb.md#pdb.Pdb "pdb.Pdb") class constructor has a new optional _readrc_ argument to control whether `.pdbrc` files should be read.

### pickle¶

Objects that need `__new__` called with keyword arguments can now be pickled using [pickle protocols](pickle.md#pickle-protocols) older than protocol version 4. Protocol version 4 already supports this case. (Contributed by Serhiy Storchaka in [bpo-24164](https://bugs.python.org/issue?@action=redirect&bpo=24164).)

### pickletools¶

[`pickletools.dis()`](pickletools.md#pickletools.dis "pickletools.dis") now outputs the implicit memo index for the `MEMOIZE` opcode. (Contributed by Serhiy Storchaka in [bpo-25382](https://bugs.python.org/issue?@action=redirect&bpo=25382).)

### pydoc¶

The [`pydoc`](pydoc.md#module-pydoc "pydoc: Documentation generator and online help system.") module has learned to respect the `MANPAGER` environment variable. (Contributed by Matthias Klose in [bpo-8637](https://bugs.python.org/issue?@action=redirect&bpo=8637).)

[`help()`](functions.md#help "help") and [`pydoc`](pydoc.md#module-pydoc "pydoc: Documentation generator and online help system.") can now list named tuple fields in the order they were defined rather than alphabetically. (Contributed by Raymond Hettinger in [bpo-24879](https://bugs.python.org/issue?@action=redirect&bpo=24879).)

### random¶

The new [`choices()`](random.md#random.choices "random.choices") function returns a list of elements of specified size from the given population with optional weights. (Contributed by Raymond Hettinger in [bpo-18844](https://bugs.python.org/issue?@action=redirect&bpo=18844).)

### re¶

Added support of modifier spans in regular expressions. Examples: `'(?i:p)ython'` matches `'python'` and `'Python'`, but not `'PYTHON'`; `'(?i)g(?-i:v)r'` matches `'GvR'` and `'gvr'`, but not `'GVR'`. (Contributed by Serhiy Storchaka in [bpo-433028](https://bugs.python.org/issue?@action=redirect&bpo=433028).)

Match object groups can be accessed by `__getitem__`, which is equivalent to `group()`. So `mo['name']` is now equivalent to `mo.group('name')`. (Contributed by Eric Smith in [bpo-24454](https://bugs.python.org/issue?@action=redirect&bpo=24454).)

[`Match`](re.md#re.Match "re.Match") objects now support [`index-like objects`](datamodel.md#object.__index__ "object.__index__") as group indices. (Contributed by Jeroen Demeyer and Xiang Zhang in [bpo-27177](https://bugs.python.org/issue?@action=redirect&bpo=27177).)

### readline¶

Added [`set_auto_history()`](readline.md#readline.set_auto_history "readline.set_auto_history") to enable or disable automatic addition of input to the history list. (Contributed by Tyler Crompton in [bpo-26870](https://bugs.python.org/issue?@action=redirect&bpo=26870).)

### rlcompleter¶

Private and special attribute names now are omitted unless the prefix starts with underscores. A space or a colon is added after some completed keywords. (Contributed by Serhiy Storchaka in [bpo-25011](https://bugs.python.org/issue?@action=redirect&bpo=25011) and [bpo-25209](https://bugs.python.org/issue?@action=redirect&bpo=25209).)

### shlex¶

The [`shlex`](shlex.md#shlex.shlex "shlex.shlex") has much [improved shell compatibility](shlex.md#improved-shell-compatibility) through the new _punctuation_chars_ argument to control which characters are treated as punctuation. (Contributed by Vinay Sajip in [bpo-1521950](https://bugs.python.org/issue?@action=redirect&bpo=1521950).)

### site¶

When specifying paths to add to [`sys.path`](3.标准库/sys.md#sys.path "sys.path") in a `.pth` file, you may now specify file paths on top of directories (e.g. zip files). (Contributed by Wolfgang Langner in [bpo-26587](https://bugs.python.org/issue?@action=redirect&bpo=26587)).

### sqlite3¶

[`sqlite3.Cursor.lastrowid`](sqlite3.md#sqlite3.Cursor.lastrowid "sqlite3.Cursor.lastrowid") now supports the `REPLACE` statement. (Contributed by Alex LordThorsen in [bpo-16864](https://bugs.python.org/issue?@action=redirect&bpo=16864).)

### socket¶

The [`ioctl()`](socket.md#socket.socket.ioctl "socket.socket.ioctl") function now supports the [`SIO_LOOPBACK_FAST_PATH`](socket.md#socket.SIO_LOOPBACK_FAST_PATH "socket.SIO_LOOPBACK_FAST_PATH") control code. (Contributed by Daniel Stokes in [bpo-26536](https://bugs.python.org/issue?@action=redirect&bpo=26536).)

The [`getsockopt()`](socket.md#socket.socket.getsockopt "socket.socket.getsockopt") constants `SO_DOMAIN`, `SO_PROTOCOL`, `SO_PEERSEC`, and `SO_PASSSEC` are now supported. (Contributed by Christian Heimes in [bpo-26907](https://bugs.python.org/issue?@action=redirect&bpo=26907).)

The [`setsockopt()`](socket.md#socket.socket.setsockopt "socket.socket.setsockopt") now supports the `setsockopt(level, optname, None, optlen: int)` form. (Contributed by Christian Heimes in [bpo-27744](https://bugs.python.org/issue?@action=redirect&bpo=27744).)

The socket module now supports the address family [`AF_ALG`](socket.md#socket.AF_ALG "socket.AF_ALG") to interface with Linux Kernel crypto API. `ALG_*`, `SOL_ALG` and [`sendmsg_afalg()`](socket.md#socket.socket.sendmsg_afalg "socket.socket.sendmsg_afalg") were added. (Contributed by Christian Heimes in [bpo-27744](https://bugs.python.org/issue?@action=redirect&bpo=27744) with support from Victor Stinner.)

New Linux constants `TCP_USER_TIMEOUT` and `TCP_CONGESTION` were added. (Contributed by Omar Sandoval, [bpo-26273](https://bugs.python.org/issue?@action=redirect&bpo=26273)).

### socketserver¶

Servers based on the [`socketserver`](socketserver.md#module-socketserver "socketserver: A framework for network servers.") module, including those defined in [`http.server`](http.server.md#module-http.server "http.server: HTTP server and request handlers."), [`xmlrpc.server`](xmlrpc.server.md#module-xmlrpc.server "xmlrpc.server: Basic XML-RPC server implementations.") and [`wsgiref.simple_server`](wsgiref.md#module-wsgiref.simple_server "wsgiref.simple_server: A simple WSGI HTTP server."), now support the [context manager](../glossary.md#term-context-manager) protocol. (Contributed by Aviv Palivoda in [bpo-26404](https://bugs.python.org/issue?@action=redirect&bpo=26404).)

The `wfile` attribute of [`StreamRequestHandler`](socketserver.md#socketserver.StreamRequestHandler "socketserver.StreamRequestHandler") classes now implements the [`io.BufferedIOBase`](io.md#io.BufferedIOBase "io.BufferedIOBase") writable interface. In particular, calling [`write()`](io.md#io.BufferedIOBase.write "io.BufferedIOBase.write") is now guaranteed to send the data in full. (Contributed by Martin Panter in [bpo-26721](https://bugs.python.org/issue?@action=redirect&bpo=26721).)

### ssl¶

[`ssl`](ssl.md#module-ssl "ssl: TLS/SSL wrapper for socket objects") supports OpenSSL 1.1.0. The minimum recommend version is 1.0.2. (Contributed by Christian Heimes in [bpo-26470](https://bugs.python.org/issue?@action=redirect&bpo=26470).)

3DES has been removed from the default cipher suites and ChaCha20 Poly1305 cipher suites have been added. (Contributed by Christian Heimes in [bpo-27850](https://bugs.python.org/issue?@action=redirect&bpo=27850) and [bpo-27766](https://bugs.python.org/issue?@action=redirect&bpo=27766).)

[`SSLContext`](ssl.md#ssl.SSLContext "ssl.SSLContext") has better default configuration for options and ciphers. (Contributed by Christian Heimes in [bpo-28043](https://bugs.python.org/issue?@action=redirect&bpo=28043).)

SSL session can be copied from one client-side connection to another with the new [`SSLSession`](ssl.md#ssl.SSLSession "ssl.SSLSession") class. TLS session resumption can speed up the initial handshake, reduce latency and improve performance (Contributed by Christian Heimes in [bpo-19500](https://bugs.python.org/issue?@action=redirect&bpo=19500) based on a draft by Alex Warhawk.)

The new [`get_ciphers()`](ssl.md#ssl.SSLContext.get_ciphers "ssl.SSLContext.get_ciphers") method can be used to get a list of enabled ciphers in order of cipher priority.

All constants and flags have been converted to [`IntEnum`](3.标准库/enum.md#enum.IntEnum "enum.IntEnum") and `IntFlags`. (Contributed by Christian Heimes in [bpo-28025](https://bugs.python.org/issue?@action=redirect&bpo=28025).)

Server and client-side specific TLS protocols for [`SSLContext`](ssl.md#ssl.SSLContext "ssl.SSLContext") were added. (Contributed by Christian Heimes in [bpo-28085](https://bugs.python.org/issue?@action=redirect&bpo=28085).)

### statistics¶

A new [`harmonic_mean()`](statistics.md#statistics.harmonic_mean "statistics.harmonic_mean") function has been added. (Contributed by Steven D'Aprano in [bpo-27181](https://bugs.python.org/issue?@action=redirect&bpo=27181).)

### struct¶

[`struct`](struct.md#module-struct "struct: Interpret bytes as packed binary data.") now supports IEEE 754 half-precision floats via the `'e'` format specifier. (Contributed by Eli Stevens, Mark Dickinson in [bpo-11734](https://bugs.python.org/issue?@action=redirect&bpo=11734).)

### subprocess¶

[`subprocess.Popen`](subprocess.md#subprocess.Popen "subprocess.Popen") destructor now emits a [`ResourceWarning`](3.标准库/exceptions.md#ResourceWarning "ResourceWarning") warning if the child process is still running. Use the context manager protocol (`with proc: ...`) or explicitly call the [`wait()`](subprocess.md#subprocess.Popen.wait "subprocess.Popen.wait") method to read the exit status of the child process. (Contributed by Victor Stinner in [bpo-26741](https://bugs.python.org/issue?@action=redirect&bpo=26741).)

The [`subprocess.Popen`](subprocess.md#subprocess.Popen "subprocess.Popen") constructor and all functions that pass arguments through to it now accept _encoding_ and _errors_ arguments. Specifying either of these will enable text mode for the _stdin_ , _stdout_ and _stderr_ streams. (Contributed by Steve Dower in [bpo-6135](https://bugs.python.org/issue?@action=redirect&bpo=6135).)

### sys¶

The new [`getfilesystemencodeerrors()`](3.标准库/sys.md#sys.getfilesystemencodeerrors "sys.getfilesystemencodeerrors") function returns the name of the error mode used to convert between Unicode filenames and bytes filenames. (Contributed by Steve Dower in [bpo-27781](https://bugs.python.org/issue?@action=redirect&bpo=27781).)

On Windows the return value of the [`getwindowsversion()`](3.标准库/sys.md#sys.getwindowsversion "sys.getwindowsversion") function now includes the _platform_version_ field which contains the accurate major version, minor version and build number of the current operating system, rather than the version that is being emulated for the process (Contributed by Steve Dower in [bpo-27932](https://bugs.python.org/issue?@action=redirect&bpo=27932).)

### telnetlib¶

`telnetlib.Telnet` is now a context manager (contributed by Stéphane Wirtel in [bpo-25485](https://bugs.python.org/issue?@action=redirect&bpo=25485)).

### time¶

The [`struct_time`](time.md#time.struct_time "time.struct_time") attributes `tm_gmtoff` and `tm_zone` are now available on all platforms.

### timeit¶

The new [`Timer.autorange()`](timeit.md#timeit.Timer.autorange "timeit.Timer.autorange") convenience method has been added to call [`Timer.timeit()`](timeit.md#timeit.Timer.timeit "timeit.Timer.timeit") repeatedly so that the total run time is greater or equal to 200 milliseconds. (Contributed by Steven D'Aprano in [bpo-6422](https://bugs.python.org/issue?@action=redirect&bpo=6422).)

[`timeit`](timeit.md#module-timeit "timeit: Measure the execution time of small code snippets.") now warns when there is substantial (4x) variance between best and worst times. (Contributed by Serhiy Storchaka in [bpo-23552](https://bugs.python.org/issue?@action=redirect&bpo=23552).)

### tkinter¶

Added methods `trace_add()`, `trace_remove()` and `trace_info()` in the `tkinter.Variable` class. They replace old methods `trace_variable()`, `trace()`, `trace_vdelete()` and `trace_vinfo()` that use obsolete Tcl commands and might not work in future versions of Tcl. (Contributed by Serhiy Storchaka in [bpo-22115](https://bugs.python.org/issue?@action=redirect&bpo=22115)).

### 回溯¶

Both the traceback module and the interpreter's builtin exception display now abbreviate long sequences of repeated lines in tracebacks as shown in the following example:

    
    
~~~shell
>>> def f(): f()
...
>>> f()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 1, in f
  File "<stdin>", line 1, in f
  File "<stdin>", line 1, in f
  [Previous line repeated 995 more times]
RecursionError: maximum recursion depth exceeded
~~~

（由 Emanuel Barry在 [bpo-26823](https://bugs.python.org/issue?@action=redirect&bpo=26823) 中贡献。）

### tracemalloc¶

The [`tracemalloc`](tracemalloc.md#module-tracemalloc "tracemalloc: Trace memory allocations.") module now supports tracing memory allocations in multiple different address spaces.

The new [`DomainFilter`](tracemalloc.md#tracemalloc.DomainFilter "tracemalloc.DomainFilter") filter class has been added to filter block traces by their address space (domain).

（由 Victor Stinner 在 [bpo-26588](https://bugs.python.org/issue?@action=redirect&bpo=26588) 中贡献。）

### typing¶

Since the [`typing`](typing.md#module-typing "typing: Support for type hints \(see :pep:`484`\).") module is [provisional](../glossary.md#term-provisional-API), all changes introduced in Python 3.6 have also been backported to Python 3.5.x.

The [`typing`](typing.md#module-typing "typing: Support for type hints \(see :pep:`484`\).") module has a much improved support for generic type aliases. For example `Dict[str, Tuple[S, T]]` is now a valid type annotation. (Contributed by Guido van Rossum in [Github #195](https://github.com/python/typing/pull/195).)

The [`typing.ContextManager`](typing.md#typing.ContextManager "typing.ContextManager") class has been added for representing [`contextlib.AbstractContextManager`](contextlib.md#contextlib.AbstractContextManager "contextlib.AbstractContextManager"). (Contributed by Brett Cannon in [bpo-25609](https://bugs.python.org/issue?@action=redirect&bpo=25609).)

The [`typing.Collection`](typing.md#typing.Collection "typing.Collection") class has been added for representing [`collections.abc.Collection`](collections.abc.md#collections.abc.Collection "collections.abc.Collection"). (Contributed by Ivan Levkivskyi in [bpo-27598](https://bugs.python.org/issue?@action=redirect&bpo=27598).)

The [`typing.ClassVar`](typing.md#typing.ClassVar "typing.ClassVar") type construct has been added to mark class variables. As introduced in [**PEP 526**](https://peps.python.org/pep-0526/), a variable annotation wrapped in ClassVar indicates that a given attribute is intended to be used as a class variable and should not be set on instances of that class. (Contributed by Ivan Levkivskyi in [Github #280](https://github.com/python/typing/pull/280).)

A new [`TYPE_CHECKING`](typing.md#typing.TYPE_CHECKING "typing.TYPE_CHECKING") constant that is assumed to be `True` by the static type checkers, but is `False` at runtime. (Contributed by Guido van Rossum in [Github #230](https://github.com/python/typing/issues/230).)

A new [`NewType()`](typing.md#typing.NewType "typing.NewType") helper function has been added to create lightweight distinct types for annotations:

    
    
~~~
from typing import NewType

UserId = NewType('UserId', int)
some_id = UserId(524313)
~~~

The static type checker will treat the new type as if it were a subclass of the original type. (Contributed by Ivan Levkivskyi in [Github #189](https://github.com/python/typing/issues/189).)

### unicodedata¶

The [`unicodedata`](unicodedata.md#module-unicodedata "unicodedata: Access the Unicode Database.") module now uses data from [Unicode 9.0.0](https://unicode.org/versions/Unicode9.0.0/). (Contributed by Benjamin Peterson.)

### unittest.mock¶

The [`Mock`](unittest.mock.md#unittest.mock.Mock "unittest.mock.Mock") class has the following improvements:

  * Two new methods, [`Mock.assert_called()`](unittest.mock.md#unittest.mock.Mock.assert_called "unittest.mock.Mock.assert_called") and [`Mock.assert_called_once()`](unittest.mock.md#unittest.mock.Mock.assert_called_once "unittest.mock.Mock.assert_called_once") to check if the mock object was called. (Contributed by Amit Saha in [bpo-26323](https://bugs.python.org/issue?@action=redirect&bpo=26323).)

  * The [`Mock.reset_mock()`](unittest.mock.md#unittest.mock.Mock.reset_mock "unittest.mock.Mock.reset_mock") method now has two optional keyword only arguments: _return_value_ and _side_effect_. (Contributed by Kushal Das in [bpo-21271](https://bugs.python.org/issue?@action=redirect&bpo=21271).)

### urllib.request¶

If a HTTP request has a file or iterable body (other than a bytes object) but no `Content-Length` header, rather than throwing an error, `AbstractHTTPHandler` now falls back to use chunked transfer encoding. (Contributed by Demian Brecht and Rolf Krahl in [bpo-12319](https://bugs.python.org/issue?@action=redirect&bpo=12319).)

### urllib.robotparser¶

[`RobotFileParser`](urllib.robotparser.md#urllib.robotparser.RobotFileParser "urllib.robotparser.RobotFileParser") now supports the `Crawl-delay` and `Request-rate` extensions. (Contributed by Nikolay Bogoychev in [bpo-16099](https://bugs.python.org/issue?@action=redirect&bpo=16099).)

### venv¶

[`venv`](3.标准库/venv.md#module-venv "venv: Creation of virtual environments.") accepts a new parameter `--prompt`. This parameter provides an alternative prefix for the virtual environment. (Proposed by Łukasz Balcerzak and ported to 3.6 by Stéphane Wirtel in [bpo-22829](https://bugs.python.org/issue?@action=redirect&bpo=22829).)

### warnings¶

A new optional _source_ parameter has been added to the [`warnings.warn_explicit()`](warnings.md#warnings.warn_explicit "warnings.warn_explicit") function: the destroyed object which emitted a [`ResourceWarning`](3.标准库/exceptions.md#ResourceWarning "ResourceWarning"). A _source_ attribute has also been added to `warnings.WarningMessage` (contributed by Victor Stinner in [bpo-26568](https://bugs.python.org/issue?@action=redirect&bpo=26568) and [bpo-26567](https://bugs.python.org/issue?@action=redirect&bpo=26567)).

When a [`ResourceWarning`](3.标准库/exceptions.md#ResourceWarning "ResourceWarning") warning is logged, the [`tracemalloc`](tracemalloc.md#module-tracemalloc "tracemalloc: Trace memory allocations.") module is now used to try to retrieve the traceback where the destroyed object was allocated.

Example with the script `example.py`:

    
    
~~~
import warnings

def func():
    return open(__file__)

f = func()
f = None
~~~

Output of the command `python3.6 -Wd -X tracemalloc=5 example.py`:

    
    
~~~
example.py:7: ResourceWarning: unclosed file <_io.TextIOWrapper name='example.py' mode='r' encoding='UTF-8'>
  f = None
Object allocated at (most recent call first):
  File "example.py", lineno 4
    return open(__file__)
  File "example.py", lineno 6
    f = func()
~~~

The "Object allocated at" traceback is new and is only displayed if [`tracemalloc`](tracemalloc.md#module-tracemalloc "tracemalloc: Trace memory allocations.") is tracing Python memory allocations and if the [`warnings`](warnings.md#module-warnings "warnings: Issue warning messages and control their disposition.") module was already imported.

### winreg¶

Added the 64-bit integer type [`REG_QWORD`](winreg.md#winreg.REG_QWORD "winreg.REG_QWORD"). (Contributed by Clement Rouault in [bpo-23026](https://bugs.python.org/issue?@action=redirect&bpo=23026).)

### winsound¶

Allowed keyword arguments to be passed to [`Beep`](winsound.md#winsound.Beep "winsound.Beep"), [`MessageBeep`](winsound.md#winsound.MessageBeep "winsound.MessageBeep"), and [`PlaySound`](winsound.md#winsound.PlaySound "winsound.PlaySound") ([bpo-27982](https://bugs.python.org/issue?@action=redirect&bpo=27982)).

### xmlrpc.client¶

The [`xmlrpc.client`](xmlrpc.client.md#module-xmlrpc.client "xmlrpc.client: XML-RPC client access.") module now supports unmarshalling additional data types used by the Apache XML-RPC implementation for numerics and `None`. (Contributed by Serhiy Storchaka in [bpo-26885](https://bugs.python.org/issue?@action=redirect&bpo=26885).)

### zipfile¶

A new [`ZipInfo.from_file()`](zipfile.md#zipfile.ZipInfo.from_file "zipfile.ZipInfo.from_file") class method allows making a [`ZipInfo`](zipfile.md#zipfile.ZipInfo "zipfile.ZipInfo") instance from a filesystem file. A new [`ZipInfo.is_dir()`](zipfile.md#zipfile.ZipInfo.is_dir "zipfile.ZipInfo.is_dir") method can be used to check if the [`ZipInfo`](zipfile.md#zipfile.ZipInfo "zipfile.ZipInfo") instance represents a directory. (Contributed by Thomas Kluyver in [bpo-26039](https://bugs.python.org/issue?@action=redirect&bpo=26039).)

The [`ZipFile.open()`](zipfile.md#zipfile.ZipFile.open "zipfile.ZipFile.open") method can now be used to write data into a ZIP file, as well as for extracting data. (Contributed by Thomas Kluyver in [bpo-26039](https://bugs.python.org/issue?@action=redirect&bpo=26039).)

### zlib¶

The [`compress()`](zlib.md#zlib.compress "zlib.compress") and [`decompress()`](zlib.md#zlib.decompress "zlib.decompress") functions now accept keyword arguments. (Contributed by Aviv Palivoda in [bpo-26243](https://bugs.python.org/issue?@action=redirect&bpo=26243) and Xiang Zhang in [bpo-16764](https://bugs.python.org/issue?@action=redirect&bpo=16764) respectively.)

## 性能优化¶

  * The Python interpreter now uses a 16-bit wordcode instead of bytecode which made a number of opcode optimizations possible. (Contributed by Demur Rumed with input and reviews from Serhiy Storchaka and Victor Stinner in [bpo-26647](https://bugs.python.org/issue?@action=redirect&bpo=26647) and [bpo-28050](https://bugs.python.org/issue?@action=redirect&bpo=28050).)

  * The [`asyncio.Future`](asyncio-future.md#asyncio.Future "asyncio.Future") class now has an optimized C implementation. (Contributed by Yury Selivanov and INADA Naoki in [bpo-26081](https://bugs.python.org/issue?@action=redirect&bpo=26081).)

  * The [`asyncio.Task`](asyncio-task.md#asyncio.Task "asyncio.Task") class now has an optimized C implementation. (Contributed by Yury Selivanov in [bpo-28544](https://bugs.python.org/issue?@action=redirect&bpo=28544).)

  * Various implementation improvements in the [`typing`](typing.md#module-typing "typing: Support for type hints \(see :pep:`484`\).") module (such as caching of generic types) allow up to 30 times performance improvements and reduced memory footprint.

  * The ASCII decoder is now up to 60 times as fast for error handlers `surrogateescape`, `ignore` and `replace` (Contributed by Victor Stinner in [bpo-24870](https://bugs.python.org/issue?@action=redirect&bpo=24870)).

  * The ASCII and the Latin1 encoders are now up to 3 times as fast for the error handler `surrogateescape` (Contributed by Victor Stinner in [bpo-25227](https://bugs.python.org/issue?@action=redirect&bpo=25227)).

  * The UTF-8 encoder is now up to 75 times as fast for error handlers `ignore`, `replace`, `surrogateescape`, `surrogatepass` (Contributed by Victor Stinner in [bpo-25267](https://bugs.python.org/issue?@action=redirect&bpo=25267)).

  * The UTF-8 decoder is now up to 15 times as fast for error handlers `ignore`, `replace` and `surrogateescape` (Contributed by Victor Stinner in [bpo-25301](https://bugs.python.org/issue?@action=redirect&bpo=25301)).

  * `bytes % args` is now up to 2 times faster. (Contributed by Victor Stinner in [bpo-25349](https://bugs.python.org/issue?@action=redirect&bpo=25349)).

  * `bytearray % args` is now between 2.5 and 5 times faster. (Contributed by Victor Stinner in [bpo-25399](https://bugs.python.org/issue?@action=redirect&bpo=25399)).

  * Optimize [`bytes.fromhex()`](stdtypes.md#bytes.fromhex "bytes.fromhex") and [`bytearray.fromhex()`](stdtypes.md#bytearray.fromhex "bytearray.fromhex"): they are now between 2x and 3.5x faster. (Contributed by Victor Stinner in [bpo-25401](https://bugs.python.org/issue?@action=redirect&bpo=25401)).

  * Optimize `bytes.replace(b'', b'.')` and `bytearray.replace(b'', b'.')`: up to 80% faster. (Contributed by Josh Snider in [bpo-26574](https://bugs.python.org/issue?@action=redirect&bpo=26574)).

  * Allocator functions of the [`PyMem_Malloc()`](memory.md#c.PyMem_Malloc "PyMem_Malloc") domain ([`PYMEM_DOMAIN_MEM`](memory.md#c.PYMEM_DOMAIN_MEM "PYMEM_DOMAIN_MEM")) now use the [pymalloc memory allocator](memory.md#pymalloc) instead of `malloc()` function of the C library. The pymalloc allocator is optimized for objects smaller or equal to 512 bytes with a short lifetime, and use `malloc()` for larger memory blocks. (Contributed by Victor Stinner in [bpo-26249](https://bugs.python.org/issue?@action=redirect&bpo=26249)).

  * [`pickle.load()`](pickle.md#pickle.load "pickle.load") and [`pickle.loads()`](pickle.md#pickle.loads "pickle.loads") are now up to 10% faster when deserializing many small objects (Contributed by Victor Stinner in [bpo-27056](https://bugs.python.org/issue?@action=redirect&bpo=27056)).

  * Passing [keyword arguments](../glossary.md#term-keyword-argument) to a function has an overhead in comparison with passing [positional arguments](../glossary.md#term-positional-argument). Now in extension functions implemented with using Argument Clinic this overhead is significantly decreased. (Contributed by Serhiy Storchaka in [bpo-27574](https://bugs.python.org/issue?@action=redirect&bpo=27574)).

  * Optimized [`glob()`](glob.md#glob.glob "glob.glob") and [`iglob()`](glob.md#glob.iglob "glob.iglob") functions in the [`glob`](glob.md#module-glob "glob: Unix shell style pathname pattern expansion.") module; they are now about 3--6 times faster. (Contributed by Serhiy Storchaka in [bpo-25596](https://bugs.python.org/issue?@action=redirect&bpo=25596)).

  * Optimized globbing in [`pathlib`](pathlib.md#module-pathlib "pathlib: Object-oriented filesystem paths") by using [`os.scandir()`](os.md#os.scandir "os.scandir"); it is now about 1.5--4 times faster. (Contributed by Serhiy Storchaka in [bpo-26032](https://bugs.python.org/issue?@action=redirect&bpo=26032)).

  * [`xml.etree.ElementTree`](xml.etree.elementtree.md#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API.") parsing, iteration and deepcopy performance has been significantly improved. (Contributed by Serhiy Storchaka in [bpo-25638](https://bugs.python.org/issue?@action=redirect&bpo=25638), [bpo-25873](https://bugs.python.org/issue?@action=redirect&bpo=25873), and [bpo-25869](https://bugs.python.org/issue?@action=redirect&bpo=25869).)

  * Creation of [`fractions.Fraction`](fractions.md#fractions.Fraction "fractions.Fraction") instances from floats and decimals is now 2 to 3 times faster. (Contributed by Serhiy Storchaka in [bpo-25971](https://bugs.python.org/issue?@action=redirect&bpo=25971).)

## 构建和 C API 的改变¶

  * Python now requires some C99 support in the toolchain to build. Most notably, Python now uses standard integer types and macros in place of custom macros like `PY_LONG_LONG`. For more information, see [**PEP 7**](https://peps.python.org/pep-0007/) and [bpo-17884](https://bugs.python.org/issue?@action=redirect&bpo=17884).

  * Cross-compiling CPython with the Android NDK and the Android API level set to 21 (Android 5.0 Lollipop) or greater runs successfully. While Android is not yet a supported platform, the Python test suite runs on the Android emulator with only about 16 tests failures. See the Android meta-issue [bpo-26865](https://bugs.python.org/issue?@action=redirect&bpo=26865).

  * The `--enable-optimizations` configure flag has been added. Turning it on will activate expensive optimizations like PGO. (Original patch by Alecsandru Patrascu of Intel in [bpo-26359](https://bugs.python.org/issue?@action=redirect&bpo=26359).)

  * The [GIL](../glossary.md#term-global-interpreter-lock) must now be held when allocator functions of [`PYMEM_DOMAIN_OBJ`](memory.md#c.PYMEM_DOMAIN_OBJ "PYMEM_DOMAIN_OBJ") (ex: [`PyObject_Malloc()`](memory.md#c.PyObject_Malloc "PyObject_Malloc")) and [`PYMEM_DOMAIN_MEM`](memory.md#c.PYMEM_DOMAIN_MEM "PYMEM_DOMAIN_MEM") (ex: [`PyMem_Malloc()`](memory.md#c.PyMem_Malloc "PyMem_Malloc")) domains are called.

  * New [`Py_FinalizeEx()`](init.md#c.Py_FinalizeEx "Py_FinalizeEx") API which indicates if flushing buffered data failed. (Contributed by Martin Panter in [bpo-5319](https://bugs.python.org/issue?@action=redirect&bpo=5319).)

  * [`PyArg_ParseTupleAndKeywords()`](arg.md#c.PyArg_ParseTupleAndKeywords "PyArg_ParseTupleAndKeywords") now supports [positional-only parameters](../glossary.md#positional-only-parameter). Positional-only parameters are defined by empty names. (Contributed by Serhiy Storchaka in [bpo-26282](https://bugs.python.org/issue?@action=redirect&bpo=26282)).

  * `PyTraceback_Print` method now abbreviates long sequences of repeated lines as `"[Previous line repeated {count} more times]"`. (Contributed by Emanuel Barry in [bpo-26823](https://bugs.python.org/issue?@action=redirect&bpo=26823).)

  * The new [`PyErr_SetImportErrorSubclass()`](10.C%20API接口/exceptions.md#c.PyErr_SetImportErrorSubclass "PyErr_SetImportErrorSubclass") function allows for specifying a subclass of [`ImportError`](3.标准库/exceptions.md#ImportError "ImportError") to raise. (Contributed by Eric Snow in [bpo-15767](https://bugs.python.org/issue?@action=redirect&bpo=15767).)

  * The new [`PyErr_ResourceWarning()`](10.C%20API接口/exceptions.md#c.PyErr_ResourceWarning "PyErr_ResourceWarning") function can be used to generate a [`ResourceWarning`](3.标准库/exceptions.md#ResourceWarning "ResourceWarning") providing the source of the resource allocation. (Contributed by Victor Stinner in [bpo-26567](https://bugs.python.org/issue?@action=redirect&bpo=26567).)

  * The new [`PyOS_FSPath()`](10.C%20API接口/sys.md#c.PyOS_FSPath "PyOS_FSPath") function returns the file system representation of a [path-like object](../glossary.md#term-path-like-object). (Contributed by Brett Cannon in [bpo-27186](https://bugs.python.org/issue?@action=redirect&bpo=27186).)

  * 现在 [`PyUnicode_FSConverter()`](10.C%20API接口/unicode.md#c.PyUnicode_FSConverter "PyUnicode_FSConverter") 和 [`PyUnicode_FSDecoder()`](10.C%20API接口/unicode.md#c.PyUnicode_FSDecoder "PyUnicode_FSDecoder") 函数将接受 [路径类对象](../glossary.md#term-path-like-object)。

## 其他改进¶

  * 当 [`--version`](cmdline.md#cmdoption-version) (简短形式: [`-V`](cmdline.md#cmdoption-V)) 提供了两次时，Python 将针对细节信息打印 [`sys.version`](3.标准库/sys.md#sys.version "sys.version")。
    
        $ ./python -VV
    Python 3.6.0b4+ (3.6:223967b49e49+, Nov 21 2016, 20:55:04)
    [GCC 4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.42.1)]
    

## 弃用¶

### 新关键字¶

`async` and `await` are not recommended to be used as variable, class, function or module names. Introduced by [**PEP 492**](https://peps.python.org/pep-0492/) in Python 3.5, they will become proper keywords in Python 3.7. Starting in Python 3.6, the use of `async` or `await` as names will generate a [`DeprecationWarning`](3.标准库/exceptions.md#DeprecationWarning "DeprecationWarning").

### 已弃用的 Python 行为¶

Raising the [`StopIteration`](3.标准库/exceptions.md#StopIteration "StopIteration") exception inside a generator will now generate a [`DeprecationWarning`](3.标准库/exceptions.md#DeprecationWarning "DeprecationWarning"), and will trigger a [`RuntimeError`](3.标准库/exceptions.md#RuntimeError "RuntimeError") in Python 3.7. See [PEP 479: Change StopIteration handling inside generators](3.5.md#whatsnew-pep-479) for details.

The `__aiter__()` method is now expected to return an asynchronous iterator directly instead of returning an awaitable as previously. Doing the former will trigger a [`DeprecationWarning`](3.标准库/exceptions.md#DeprecationWarning "DeprecationWarning"). Backward compatibility will be removed in Python 3.7. (Contributed by Yury Selivanov in [bpo-27243](https://bugs.python.org/issue?@action=redirect&bpo=27243).)

A backslash-character pair that is not a valid escape sequence now generates a [`DeprecationWarning`](3.标准库/exceptions.md#DeprecationWarning "DeprecationWarning"). Although this will eventually become a [`SyntaxError`](3.标准库/exceptions.md#SyntaxError "SyntaxError"), that will not be for several Python releases. (Contributed by Emanuel Barry in [bpo-27364](https://bugs.python.org/issue?@action=redirect&bpo=27364).)

When performing a relative import, falling back on `__name__` and `__path__` from the calling module when `__spec__` or `__package__` are not defined now raises an [`ImportWarning`](3.标准库/exceptions.md#ImportWarning "ImportWarning"). (Contributed by Rose Ames in [bpo-25791](https://bugs.python.org/issue?@action=redirect&bpo=25791).)

### 已弃用的 Python 模块、函数和方法¶

#### asynchat¶

The `asynchat` has been deprecated in favor of [`asyncio`](asyncio.md#module-asyncio "asyncio: Asynchronous I/O."). (Contributed by Mariatta in [bpo-25002](https://bugs.python.org/issue?@action=redirect&bpo=25002).)

#### asyncore¶

The `asyncore` has been deprecated in favor of [`asyncio`](asyncio.md#module-asyncio "asyncio: Asynchronous I/O."). (Contributed by Mariatta in [bpo-25002](https://bugs.python.org/issue?@action=redirect&bpo=25002).)

#### dbm¶

Unlike other [`dbm`](../library/dbm.md#module-dbm "dbm: Interfaces to various Unix "database" formats.") implementations, the [`dbm.dumb`](dbm.md#module-dbm.dumb "dbm.dumb: Portable implementation of the simple DBM interface.") module creates databases with the `'rw'` mode and allows modifying the database opened with the `'r'` mode. This behavior is now deprecated and will be removed in 3.8. (Contributed by Serhiy Storchaka in [bpo-21708](https://bugs.python.org/issue?@action=redirect&bpo=21708).)

#### distutils¶

The undocumented `extra_path` argument to the `distutils.Distribution` constructor is now considered deprecated and will raise a warning if set. Support for this parameter will be removed in a future Python release. See [bpo-27919](https://bugs.python.org/issue?@action=redirect&bpo=27919) for details.

#### grp¶

The support of non-integer arguments in [`getgrgid()`](grp.md#grp.getgrgid "grp.getgrgid") has been deprecated. (Contributed by Serhiy Storchaka in [bpo-26129](https://bugs.python.org/issue?@action=redirect&bpo=26129).)

#### importlib¶

The [`importlib.machinery.SourceFileLoader.load_module()`](importlib.md#importlib.machinery.SourceFileLoader.load_module "importlib.machinery.SourceFileLoader.load_module") and [`importlib.machinery.SourcelessFileLoader.load_module()`](importlib.md#importlib.machinery.SourcelessFileLoader.load_module "importlib.machinery.SourcelessFileLoader.load_module") methods are now deprecated. They were the only remaining implementations of [`importlib.abc.Loader.load_module()`](importlib.md#importlib.abc.Loader.load_module "importlib.abc.Loader.load_module") in [`importlib`](importlib.md#module-importlib "importlib: The implementation of the import machinery.") that had not been deprecated in previous versions of Python in favour of [`importlib.abc.Loader.exec_module()`](importlib.md#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module").

The [`importlib.machinery.WindowsRegistryFinder`](importlib.md#importlib.machinery.WindowsRegistryFinder "importlib.machinery.WindowsRegistryFinder") class is now deprecated. As of 3.6.0, it is still added to [`sys.meta_path`](3.标准库/sys.md#sys.meta_path "sys.meta_path") by default (on Windows), but this may change in future releases.

#### os¶

Undocumented support of general [bytes-like objects](../glossary.md#term-bytes-like-object) as paths in [`os`](os.md#module-os "os: Miscellaneous operating system interfaces.") functions, [`compile()`](functions.md#compile "compile") and similar functions is now deprecated. (Contributed by Serhiy Storchaka in [bpo-25791](https://bugs.python.org/issue?@action=redirect&bpo=25791) and [bpo-26754](https://bugs.python.org/issue?@action=redirect&bpo=26754).)

#### re¶

Support for inline flags `(?letters)` in the middle of the regular expression has been deprecated and will be removed in a future Python version. Flags at the start of a regular expression are still allowed. (Contributed by Serhiy Storchaka in [bpo-22493](https://bugs.python.org/issue?@action=redirect&bpo=22493).)

#### ssl¶

OpenSSL 0.9.8, 1.0.0 and 1.0.1 are deprecated and no longer supported. In the future the [`ssl`](ssl.md#module-ssl "ssl: TLS/SSL wrapper for socket objects") module will require at least OpenSSL 1.0.2 or 1.1.0.

SSL-related arguments like `certfile`, `keyfile` and `check_hostname` in [`ftplib`](ftplib.md#module-ftplib "ftplib: FTP protocol client \(requires sockets\)."), [`http.client`](http.client.md#module-http.client "http.client: HTTP and HTTPS protocol client \(requires sockets\)."), [`imaplib`](imaplib.md#module-imaplib "imaplib: IMAP4 protocol client \(requires sockets\)."), [`poplib`](poplib.md#module-poplib "poplib: POP3 protocol client \(requires sockets\)."), and [`smtplib`](smtplib.md#module-smtplib "smtplib: SMTP protocol client \(requires sockets\).") have been deprecated in favor of `context`. (Contributed by Christian Heimes in [bpo-28022](https://bugs.python.org/issue?@action=redirect&bpo=28022).)

A couple of protocols and functions of the [`ssl`](ssl.md#module-ssl "ssl: TLS/SSL wrapper for socket objects") module are now deprecated. Some features will no longer be available in future versions of OpenSSL. Other features are deprecated in favor of a different API. (Contributed by Christian Heimes in [bpo-28022](https://bugs.python.org/issue?@action=redirect&bpo=28022) and [bpo-26470](https://bugs.python.org/issue?@action=redirect&bpo=26470).)

#### tkinter¶

The `tkinter.tix` module is now deprecated. [`tkinter`](tkinter.md#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") users should use [`tkinter.ttk`](tkinter.ttk.md#module-tkinter.ttk "tkinter.ttk: Tk themed widget set") instead.

#### venv¶

The `pyvenv` script has been deprecated in favour of `python3 -m venv`. This prevents confusion as to what Python interpreter `pyvenv` is connected to and thus what Python interpreter will be used by the virtual environment. (Contributed by Brett Cannon in [bpo-25154](https://bugs.python.org/issue?@action=redirect&bpo=25154).)

### 已弃用的 C API 函数和类型¶

Undocumented functions `PyUnicode_AsEncodedObject()`, `PyUnicode_AsDecodedObject()`, `PyUnicode_AsEncodedUnicode()` and `PyUnicode_AsDecodedUnicode()` are deprecated now. Use the [generic codec based API](codec.md#codec-registry) instead.

### 弃用的构建选项¶

The `--with-system-ffi` configure flag is now on by default on non-macOS UNIX platforms. It may be disabled by using `--without-system-ffi`, but using the flag is deprecated and will not be accepted in Python 3.7. macOS is unaffected by this change. Note that many OS distributors already use the `--with-system-ffi` flag when building their system Python.

## 移除¶

### API 与特性的移除¶

  * Unknown escapes consisting of `'\'` and an ASCII letter in regular expressions will now cause an error. In replacement templates for [`re.sub()`](re.md#re.sub "re.sub") they are still allowed, but deprecated. The [`re.LOCALE`](re.md#re.LOCALE "re.LOCALE") flag can now only be used with binary patterns.

  * `inspect.getmoduleinfo()` was removed (was deprecated since CPython 3.3). [`inspect.getmodulename()`](inspect.md#inspect.getmodulename "inspect.getmodulename") should be used for obtaining the module name for a given path. (Contributed by Yury Selivanov in [bpo-13248](https://bugs.python.org/issue?@action=redirect&bpo=13248).)

  * `traceback.Ignore` class and `traceback.usage`, `traceback.modname`, `traceback.fullmodname`, `traceback.find_lines_from_code`, `traceback.find_lines`, `traceback.find_strings`, `traceback.find_executable_lines` methods were removed from the [`traceback`](traceback.md#module-traceback "traceback: Print or retrieve a stack traceback.") module. They were undocumented methods deprecated since Python 3.2 and equivalent functionality is available from private methods.

  * The `tk_menuBar()` and `tk_bindForTraversal()` dummy methods in [`tkinter`](tkinter.md#module-tkinter "tkinter: Interface to Tcl/Tk for graphical user interfaces") widget classes were removed (corresponding Tk commands were obsolete since Tk 4.0).

  * The [`open()`](zipfile.md#zipfile.ZipFile.open "zipfile.ZipFile.open") method of the [`zipfile.ZipFile`](zipfile.md#zipfile.ZipFile "zipfile.ZipFile") class no longer supports the `'U'` mode (was deprecated since Python 3.4). Use [`io.TextIOWrapper`](io.md#io.TextIOWrapper "io.TextIOWrapper") for reading compressed text files in [universal newlines](../glossary.md#term-universal-newlines) mode.

  * The undocumented `IN`, `CDROM`, `DLFCN`, `TYPES`, `CDIO`, and `STROPTS` modules have been removed. They had been available in the platform specific `Lib/plat-*/` directories, but were chronically out of date, inconsistently available across platforms, and unmaintained. The script that created these modules is still available in the source distribution at [Tools/scripts/h2py.py](https://github.com/python/cpython/blob/v3.6.15/Tools/scripts/h2py.py).

  * The deprecated `asynchat.fifo` class has been removed.

## 移植到Python 3.6¶

本节列出了先前描述的更改以及可能需要更改代码的其他错误修正.

###  'python' 命令行为的变化¶

  * The output of a special Python build with defined `COUNT_ALLOCS`, `SHOW_ALLOC_COUNT` or `SHOW_TRACK_COUNT` macros is now off by default. It can be re-enabled using the `-X showalloccount` option. It now outputs to `stderr` instead of `stdout`. (Contributed by Serhiy Storchaka in [bpo-23034](https://bugs.python.org/issue?@action=redirect&bpo=23034).)

### Python API 的变化¶

  * [`open()`](functions.md#open "open") will no longer allow combining the `'U'` mode flag with `'+'`. (Contributed by Jeff Balogh and John O'Connor in [bpo-2091](https://bugs.python.org/issue?@action=redirect&bpo=2091).)

  * [`sqlite3`](sqlite3.md#module-sqlite3 "sqlite3: A DB-API 2.0 implementation using SQLite 3.x.") no longer implicitly commits an open transaction before DDL statements.

  * On Linux, [`os.urandom()`](os.md#os.urandom "os.urandom") now blocks until the system urandom entropy pool is initialized to increase the security.

  * When [`importlib.abc.Loader.exec_module()`](importlib.md#importlib.abc.Loader.exec_module "importlib.abc.Loader.exec_module") is defined, [`importlib.abc.Loader.create_module()`](importlib.md#importlib.abc.Loader.create_module "importlib.abc.Loader.create_module") must also be defined.

  * [`PyErr_SetImportError()`](10.C%20API接口/exceptions.md#c.PyErr_SetImportError "PyErr_SetImportError") now sets [`TypeError`](3.标准库/exceptions.md#TypeError "TypeError") when its **msg** argument is not set. Previously only `NULL` was returned.

  * The format of the `co_lnotab` attribute of code objects changed to support a negative line number delta. By default, Python does not emit bytecode with a negative line number delta. Functions using `frame.f_lineno`, `PyFrame_GetLineNumber()` or `PyCode_Addr2Line()` are not affected. Functions directly decoding `co_lnotab` should be updated to use a signed 8-bit integer type for the line number delta, but this is only required to support applications using a negative line number delta. See `Objects/lnotab_notes.txt` for the `co_lnotab` format and how to decode it, and see the [**PEP 511**](https://peps.python.org/pep-0511/) for the rationale.

  * The functions in the [`compileall`](compileall.md#module-compileall "compileall: Tools for byte-compiling all Python source files in a directory tree.") module now return booleans instead of `1` or `0` to represent success or failure, respectively. Thanks to booleans being a subclass of integers, this should only be an issue if you were doing identity checks for `1` or `0`. See [bpo-25768](https://bugs.python.org/issue?@action=redirect&bpo=25768).

  * Reading the `port` attribute of [`urllib.parse.urlsplit()`](urllib.parse.md#urllib.parse.urlsplit "urllib.parse.urlsplit") and [`urlparse()`](urllib.parse.md#urllib.parse.urlparse "urllib.parse.urlparse") results now raises [`ValueError`](3.标准库/exceptions.md#ValueError "ValueError") for out-of-range values, rather than returning [`None`](constants.md#None "None"). See [bpo-20059](https://bugs.python.org/issue?@action=redirect&bpo=20059).

  * The `imp` module now raises a [`DeprecationWarning`](3.标准库/exceptions.md#DeprecationWarning "DeprecationWarning") instead of [`PendingDeprecationWarning`](3.标准库/exceptions.md#PendingDeprecationWarning "PendingDeprecationWarning").

  * The following modules have had missing APIs added to their `__all__` attributes to match the documented APIs: [`calendar`](calendar.md#module-calendar "calendar: Functions for working with calendars, including some emulation of the Unix cal program."), `cgi`, [`csv`](csv.md#module-csv "csv: Write and read tabular data to and from delimited files."), [`ElementTree`](xml.etree.elementtree.md#module-xml.etree.ElementTree "xml.etree.ElementTree: Implementation of the ElementTree API."), [`enum`](3.标准库/enum.md#module-enum "enum: Implementation of an enumeration class."), [`fileinput`](fileinput.md#module-fileinput "fileinput: Loop over standard input or a list of files."), [`ftplib`](ftplib.md#module-ftplib "ftplib: FTP protocol client \(requires sockets\)."), [`logging`](3.标准库/logging.md#module-logging "logging: Flexible event logging system for applications."), [`mailbox`](mailbox.md#module-mailbox "mailbox: Manipulate mailboxes in various formats"), [`mimetypes`](mimetypes.md#module-mimetypes "mimetypes: Mapping of filename extensions to MIME types."), [`optparse`](optparse.md#module-optparse "optparse: Command-line option parsing library.（已弃用）"), [`plistlib`](plistlib.md#module-plistlib "plistlib: Generate and parse Apple plist files."), `smtpd`, [`subprocess`](subprocess.md#module-subprocess "subprocess: Subprocess management."), [`tarfile`](tarfile.md#module-tarfile "tarfile: Read and write tar-format archive files."), [`threading`](threading.md#module-threading "threading: Thread-based parallelism.") and [`wave`](wave.md#module-wave "wave: Provide an interface to the WAV sound format."). This means they will export new symbols when `import *` is used. (Contributed by Joel Taddei and Jacek Kołodziej in [bpo-23883](https://bugs.python.org/issue?@action=redirect&bpo=23883).)

  * When performing a relative import, if `__package__` does not compare equal to `__spec__.parent` then [`ImportWarning`](3.标准库/exceptions.md#ImportWarning "ImportWarning") is raised. (Contributed by Brett Cannon in [bpo-25791](https://bugs.python.org/issue?@action=redirect&bpo=25791).)

  * When a relative import is performed and no parent package is known, then [`ImportError`](3.标准库/exceptions.md#ImportError "ImportError") will be raised. Previously, [`SystemError`](3.标准库/exceptions.md#SystemError "SystemError") could be raised. (Contributed by Brett Cannon in [bpo-18018](https://bugs.python.org/issue?@action=redirect&bpo=18018).)

  * Servers based on the [`socketserver`](socketserver.md#module-socketserver "socketserver: A framework for network servers.") module, including those defined in [`http.server`](http.server.md#module-http.server "http.server: HTTP server and request handlers."), [`xmlrpc.server`](xmlrpc.server.md#module-xmlrpc.server "xmlrpc.server: Basic XML-RPC server implementations.") and [`wsgiref.simple_server`](wsgiref.md#module-wsgiref.simple_server "wsgiref.simple_server: A simple WSGI HTTP server."), now only catch exceptions derived from [`Exception`](3.标准库/exceptions.md#Exception "Exception"). Therefore if a request handler raises an exception like [`SystemExit`](3.标准库/exceptions.md#SystemExit "SystemExit") or [`KeyboardInterrupt`](3.标准库/exceptions.md#KeyboardInterrupt "KeyboardInterrupt"), [`handle_error()`](socketserver.md#socketserver.BaseServer.handle_error "socketserver.BaseServer.handle_error") is no longer called, and the exception will stop a single-threaded server. (Contributed by Martin Panter in [bpo-23430](https://bugs.python.org/issue?@action=redirect&bpo=23430).)

  * `spwd.getspnam()` now raises a [`PermissionError`](3.标准库/exceptions.md#PermissionError "PermissionError") instead of [`KeyError`](3.标准库/exceptions.md#KeyError "KeyError") if the user doesn't have privileges.

  * The [`socket.socket.close()`](socket.md#socket.socket.close "socket.socket.close") method now raises an exception if an error (e.g. `EBADF`) was reported by the underlying system call. (Contributed by Martin Panter in [bpo-26685](https://bugs.python.org/issue?@action=redirect&bpo=26685).)

  * The _decode_data_ argument for the `smtpd.SMTPChannel` and `smtpd.SMTPServer` constructors is now `False` by default. This means that the argument passed to `process_message()` is now a bytes object by default, and `process_message()` will be passed keyword arguments. Code that has already been updated in accordance with the deprecation warning generated by 3.5 will not be affected.

  * All optional arguments of the [`dump()`](json.md#json.dump "json.dump"), [`dumps()`](json.md#json.dumps "json.dumps"), [`load()`](json.md#json.load "json.load") and [`loads()`](json.md#json.loads "json.loads") functions and [`JSONEncoder`](json.md#json.JSONEncoder "json.JSONEncoder") and [`JSONDecoder`](json.md#json.JSONDecoder "json.JSONDecoder") class constructors in the [`json`](json.md#module-json "json: Encode and decode the JSON format.") module are now [keyword-only](../glossary.md#keyword-only-parameter). (Contributed by Serhiy Storchaka in [bpo-18726](https://bugs.python.org/issue?@action=redirect&bpo=18726).)

  * [`type`](functions.md#type "type") 的子类如果未重载 `type.__new__`，将不再能使用一个参数的形式来获取对象的类型。

  * As part of [**PEP 487**](https://peps.python.org/pep-0487/), the handling of keyword arguments passed to [`type`](functions.md#type "type") (other than the metaclass hint, `metaclass`) is now consistently delegated to [`object.__init_subclass__()`](datamodel.md#object.__init_subclass__ "object.__init_subclass__"). This means that `type.__new__()` and `type.__init__()` both now accept arbitrary keyword arguments, but [`object.__init_subclass__()`](datamodel.md#object.__init_subclass__ "object.__init_subclass__") (which is called from `type.__new__()`) will reject them by default. Custom metaclasses accepting additional keyword arguments will need to adjust their calls to `type.__new__()` (whether direct or via [`super`](functions.md#super "super")) accordingly.

  * In `distutils.command.sdist.sdist`, the `default_format` attribute has been removed and is no longer honored. Instead, the gzipped tarfile format is the default on all platforms and no platform-specific selection is made. In environments where distributions are built on Windows and zip distributions are required, configure the project with a `setup.cfg` file containing the following:
    
        [sdist]
    formats=zip
    

This behavior has also been backported to earlier Python versions by Setuptools 26.0.0.

  * In the [`urllib.request`](urllib.request.md#module-urllib.request "urllib.request: Extensible library for opening URLs.") module and the [`http.client.HTTPConnection.request()`](http.client.md#http.client.HTTPConnection.request "http.client.HTTPConnection.request") method, if no Content-Length header field has been specified and the request body is a file object, it is now sent with HTTP 1.1 chunked encoding. If a file object has to be sent to a HTTP 1.0 server, the Content-Length value now has to be specified by the caller. (Contributed by Demian Brecht and Rolf Krahl with tweaks from Martin Panter in [bpo-12319](https://bugs.python.org/issue?@action=redirect&bpo=12319).)

  * The [`DictReader`](csv.md#csv.DictReader "csv.DictReader") now returns rows of type [`OrderedDict`](collections.md#collections.OrderedDict "collections.OrderedDict"). (Contributed by Steve Holden in [bpo-27842](https://bugs.python.org/issue?@action=redirect&bpo=27842).)

  * The `crypt.METHOD_CRYPT` will no longer be added to `crypt.methods` if unsupported by the platform. (Contributed by Victor Stinner in [bpo-25287](https://bugs.python.org/issue?@action=redirect&bpo=25287).)

  * The _verbose_ and _rename_ arguments for [`namedtuple()`](collections.md#collections.namedtuple "collections.namedtuple") are now keyword-only. (Contributed by Raymond Hettinger in [bpo-25628](https://bugs.python.org/issue?@action=redirect&bpo=25628).)

  * On Linux, [`ctypes.util.find_library()`](ctypes.md#ctypes.util.find_library "ctypes.util.find_library") now looks in `LD_LIBRARY_PATH` for shared libraries. (Contributed by Vinay Sajip in [bpo-9998](https://bugs.python.org/issue?@action=redirect&bpo=9998).)

  * The [`imaplib.IMAP4`](imaplib.md#imaplib.IMAP4 "imaplib.IMAP4") class now handles flags containing the `']'` character in messages sent from the server to improve real-world compatibility. (Contributed by Lita Cho in [bpo-21815](https://bugs.python.org/issue?@action=redirect&bpo=21815).)

  * The `mmap.write()` function now returns the number of bytes written like other write methods. (Contributed by Jakub Stasiak in [bpo-26335](https://bugs.python.org/issue?@action=redirect&bpo=26335).)

  * The [`pkgutil.iter_modules()`](pkgutil.md#pkgutil.iter_modules "pkgutil.iter_modules") and [`pkgutil.walk_packages()`](pkgutil.md#pkgutil.walk_packages "pkgutil.walk_packages") functions now return [`ModuleInfo`](pkgutil.md#pkgutil.ModuleInfo "pkgutil.ModuleInfo") named tuples. (Contributed by Ramchandra Apte in [bpo-17211](https://bugs.python.org/issue?@action=redirect&bpo=17211).)

  * [`re.sub()`](re.md#re.sub "re.sub") now raises an error for invalid numerical group references in replacement templates even if the pattern is not found in the string. The error message for invalid group references now includes the group index and the position of the reference. (Contributed by SilentGhost, Serhiy Storchaka in [bpo-25953](https://bugs.python.org/issue?@action=redirect&bpo=25953).)

  * [`zipfile.ZipFile`](zipfile.md#zipfile.ZipFile "zipfile.ZipFile") will now raise [`NotImplementedError`](3.标准库/exceptions.md#NotImplementedError "NotImplementedError") for unrecognized compression values. Previously a plain [`RuntimeError`](3.标准库/exceptions.md#RuntimeError "RuntimeError") was raised. Additionally, calling [`ZipFile`](zipfile.md#zipfile.ZipFile "zipfile.ZipFile") methods on a closed ZipFile or calling the [`write()`](zipfile.md#zipfile.ZipFile.write "zipfile.ZipFile.write") method on a ZipFile created with mode `'r'` will raise a [`ValueError`](3.标准库/exceptions.md#ValueError "ValueError"). Previously, a [`RuntimeError`](3.标准库/exceptions.md#RuntimeError "RuntimeError") was raised in those scenarios.

  * when custom metaclasses are combined with zero-argument [`super()`](functions.md#super "super") or direct references from methods to the implicit `__class__` closure variable, the implicit `__classcell__` namespace entry must now be passed up to `type.__new__` for initialisation. Failing to do so will result in a [`DeprecationWarning`](3.标准库/exceptions.md#DeprecationWarning "DeprecationWarning") in Python 3.6 and a [`RuntimeError`](3.标准库/exceptions.md#RuntimeError "RuntimeError") in Python 3.8.

  * With the introduction of [`ModuleNotFoundError`](3.标准库/exceptions.md#ModuleNotFoundError "ModuleNotFoundError"), import system consumers may start expecting import system replacements to raise that more specific exception when appropriate, rather than the less-specific [`ImportError`](3.标准库/exceptions.md#ImportError "ImportError"). To provide future compatibility with such consumers, implementors of alternative import systems that completely replace [`__import__()`](functions.md#import__ "__import__") will need to update their implementations to raise the new subclass when a module can't be found at all. Implementors of compliant plugins to the default import system shouldn't need to make any changes, as the default import system will raise the new subclass when appropriate.

### C API 的变化¶

  * The [`PyMem_Malloc()`](memory.md#c.PyMem_Malloc "PyMem_Malloc") allocator family now uses the [pymalloc allocator](memory.md#pymalloc) rather than the system `malloc()`. Applications calling [`PyMem_Malloc()`](memory.md#c.PyMem_Malloc "PyMem_Malloc") without holding the GIL can now crash. Set the [`PYTHONMALLOC`](cmdline.md#envvar-PYTHONMALLOC) environment variable to `debug` to validate the usage of memory allocators in your application. See [bpo-26249](https://bugs.python.org/issue?@action=redirect&bpo=26249).

  * [`Py_Exit()`](10.C%20API接口/sys.md#c.Py_Exit "Py_Exit") (and the main interpreter) now override the exit status with 120 if flushing buffered data failed. See [bpo-5319](https://bugs.python.org/issue?@action=redirect&bpo=5319).

### CPython 字节码的改变¶

There have been several major changes to the [bytecode](../glossary.md#term-bytecode) in Python 3.6.

  * The Python interpreter now uses a 16-bit wordcode instead of bytecode. (Contributed by Demur Rumed with input and reviews from Serhiy Storchaka and Victor Stinner in [bpo-26647](https://bugs.python.org/issue?@action=redirect&bpo=26647) and [bpo-28050](https://bugs.python.org/issue?@action=redirect&bpo=28050).)

  * The new `FORMAT_VALUE` and [`BUILD_STRING`](dis.md#opcode-BUILD_STRING) opcodes as part of the formatted string literal implementation. (Contributed by Eric Smith in [bpo-25483](https://bugs.python.org/issue?@action=redirect&bpo=25483) and Serhiy Storchaka in [bpo-27078](https://bugs.python.org/issue?@action=redirect&bpo=27078).)

  * The new [`BUILD_CONST_KEY_MAP`](dis.md#opcode-BUILD_CONST_KEY_MAP) opcode to optimize the creation of dictionaries with constant keys. (Contributed by Serhiy Storchaka in [bpo-27140](https://bugs.python.org/issue?@action=redirect&bpo=27140).)

  * The function call opcodes have been heavily reworked for better performance and simpler implementation. The [`MAKE_FUNCTION`](dis.md#opcode-MAKE_FUNCTION), `CALL_FUNCTION`, `CALL_FUNCTION_KW` and `BUILD_MAP_UNPACK_WITH_CALL` opcodes have been modified, the new [`CALL_FUNCTION_EX`](dis.md#opcode-CALL_FUNCTION_EX) and `BUILD_TUPLE_UNPACK_WITH_CALL` have been added, and `CALL_FUNCTION_VAR`, `CALL_FUNCTION_VAR_KW` and `MAKE_CLOSURE` opcodes have been removed. (Contributed by Demur Rumed in [bpo-27095](https://bugs.python.org/issue?@action=redirect&bpo=27095), and Serhiy Storchaka in [bpo-27213](https://bugs.python.org/issue?@action=redirect&bpo=27213), [bpo-28257](https://bugs.python.org/issue?@action=redirect&bpo=28257).)

  * The new [`SETUP_ANNOTATIONS`](dis.md#opcode-SETUP_ANNOTATIONS) and `STORE_ANNOTATION` opcodes have been added to support the new [variable annotation](../glossary.md#term-variable-annotation) syntax. (Contributed by Ivan Levkivskyi in [bpo-27985](https://bugs.python.org/issue?@action=redirect&bpo=27985).)

## Python 3.6.2 中的重要变化¶

### New `make regen-all` build target¶

To simplify cross-compilation, and to ensure that CPython can reliably be compiled without requiring an existing version of Python to already be available, the autotools-based build system no longer attempts to implicitly recompile generated files based on file modification times.

Instead, a new `make regen-all` command has been added to force regeneration of these files when desired (e.g. after an initial version of Python has already been built based on the pregenerated versions).

More selective regeneration targets are also defined - see [Makefile.pre.in](https://github.com/python/cpython/tree/3.12/Makefile.pre.in) for details.

（由 Victor Stinner 在 [bpo-23404](https://bugs.python.org/issue?@action=redirect&bpo=23404) 中贡献。）

在 3.6.2 版本加入.

### Removal of `make touch` build target¶

The `make touch` build target previously used to request implicit regeneration of generated files by updating their modification times has been removed.

It has been replaced by the new `make regen-all` target.

（由 Victor Stinner 在 [bpo-23404](https://bugs.python.org/issue?@action=redirect&bpo=23404) 中贡献。）

在 3.6.2 版本发生变更.

## Python 3.6.4 中的重要变化¶

The `PyExc_RecursionErrorInst` singleton that was part of the public API has been removed as its members being never cleared may cause a segfault during finalization of the interpreter. (Contributed by Xavier de Gaye in [bpo-22898](https://bugs.python.org/issue?@action=redirect&bpo=22898) and [bpo-30697](https://bugs.python.org/issue?@action=redirect&bpo=30697).)

## Python 3.6.5 中的重要变化¶

The [`locale.localeconv()`](locale.md#locale.localeconv "locale.localeconv") function now sets temporarily the `LC_CTYPE` locale to the `LC_NUMERIC` locale in some cases. (Contributed by Victor Stinner in [bpo-31900](https://bugs.python.org/issue?@action=redirect&bpo=31900).)

## Python 3.6.7 中的重要变化¶

In 3.6.7 the [`tokenize`](tokenize.md#module-tokenize "tokenize: Lexical scanner for Python source code.") module now implicitly emits a `NEWLINE` token when provided with input that does not have a trailing new line. This behavior now matches what the C tokenizer does internally. (Contributed by Ammar Askar in [bpo-33899](https://bugs.python.org/issue?@action=redirect&bpo=33899).)

## Python 3.6.10 中的重要变化¶

出于重要的安全性考量，[`asyncio.loop.create_datagram_endpoint()`](asyncio-eventloop.md#asyncio.loop.create_datagram_endpoint "asyncio.loop.create_datagram_endpoint") 的 _reuse_address_ 形参不再被支持。 这是由 UDP 中的套接字选项 `SO_REUSEADDR` 的行为导致的。 更多细节请参阅 `loop.create_datagram_endpoint()` 的文档。 （由 Kyle Stanley, Antoine Pitrou 和 Yury Selivanov 在 [bpo-37228](https://bugs.python.org/issue?@action=redirect&bpo=37228) 中贡献。。）

## Notable changes in Python 3.6.13¶

Earlier Python versions allowed using both `;` and `&` as query parameter separators in [`urllib.parse.parse_qs()`](urllib.parse.md#urllib.parse.parse_qs "urllib.parse.parse_qs") and [`urllib.parse.parse_qsl()`](urllib.parse.md#urllib.parse.parse_qsl "urllib.parse.parse_qsl"). Due to security concerns, and to conform with newer W3C recommendations, this has been changed to allow only a single separator key, with `&` as the default. This change also affects `cgi.parse()` and `cgi.parse_multipart()` as they use the affected functions internally. For more details, please see their respective documentation. (Contributed by Adam Goldschmidt, Senthil Kumaran and Ken Jin in [bpo-42967](https://bugs.python.org/issue?@action=redirect&bpo=42967).)

